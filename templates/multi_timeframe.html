
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マルチタイムフレーム予測</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .prediction-form { background: #f5f5f5; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        .result-section { background: white; padding: 20px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 20px; }
        .timeframe-card { border: 1px solid #ccc; border-radius: 5px; padding: 15px; margin: 10px 0; }
        .prediction-high { background-color: #e8f5e8; }
        .prediction-medium { background-color: #fff3cd; }
        .prediction-low { background-color: #f8d7da; }
        .chart-container { height: 600px; margin: 20px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>マルチタイムフレーム予測システム</h1>

        <div class="prediction-form">
            <h2>銘柄予測</h2>
            <input type="text" id="symbolInput" placeholder="銘柄コード (例: 7203)" />
            <button onclick="predictSymbol()">予測実行</button>
            <button onclick="showChart()">チャート表示</button>
        </div>

        <div id="resultSection" class="result-section" style="display: none;">
            <h2>予測結果</h2>
            <div id="integrationResult"></div>
            <div id="timeframeResults"></div>
        </div>

        <div id="chartContainer" class="chart-container" style="display: none;"></div>
    </div>

    <script>
        async function predictSymbol() {
            const symbol = document.getElementById('symbolInput').value;
            if (!symbol) {
                alert('銘柄コードを入力してください');
                return;
            }

            try {
                const response = await fetch(`/api/multi-timeframe/predict/${symbol}`);
                const data = await response.json();

                if (data.success) {
                    displayPredictionResult(data.prediction);
                    document.getElementById('resultSection').style.display = 'block';
                } else {
                    alert('予測に失敗しました: ' + data.error);
                }
            } catch (error) {
                alert('エラーが発生しました: ' + error.message);
            }
        }

        async function showChart() {
            const symbol = document.getElementById('symbolInput').value;
            if (!symbol) {
                alert('銘柄コードを入力してください');
                return;
            }

            try {
                const response = await fetch(`/api/multi-timeframe/chart/${symbol}`);
                const data = await response.json();

                if (data.success) {
                    Plotly.newPlot('chartContainer', data.chart.data, data.chart.layout);
                    document.getElementById('chartContainer').style.display = 'block';
                } else {
                    alert('チャート生成に失敗しました: ' + data.error);
                }
            } catch (error) {
                alert('エラーが発生しました: ' + error.message);
            }
        }

        function displayPredictionResult(prediction) {
            // 統合結果表示
            const integrationHtml = `
                <h3>統合予測結果</h3>
                <p><strong>方向:</strong> ${prediction.integrated_direction}</p>
                <p><strong>信頼度:</strong> ${(prediction.integrated_confidence * 100).toFixed(1)}%</p>
                <p><strong>一貫性:</strong> ${(prediction.consistency_score * 100).toFixed(1)}%</p>
                <p><strong>リスク評価:</strong> ${prediction.risk_assessment}</p>
                <p><strong>推奨:</strong> ${prediction.recommendation}</p>
            `;
            document.getElementById('integrationResult').innerHTML = integrationHtml;

            // タイムフレーム別結果表示
            let timeframeHtml = '<h3>タイムフレーム別予測</h3>';
            for (const [timeframe, predictions] of Object.entries(prediction.timeframe_predictions)) {
                timeframeHtml += `
                    <div class="timeframe-card">
                        <h4>${timeframe}</h4>
                `;
                predictions.forEach(pred => {
                    const confidenceClass = pred.confidence > 0.7 ? 'prediction-high' :
                                          pred.confidence > 0.5 ? 'prediction-medium' : 'prediction-low';
                    timeframeHtml += `
                        <div class="${confidenceClass}" style="margin: 5px 0; padding: 10px; border-radius: 3px;">
                            <strong>${pred.task}:</strong> ${pred.prediction}
                            (信頼度: ${(pred.confidence * 100).toFixed(1)}%)
                            <br><small>${pred.explanation}</small>
                        </div>
                    `;
                });
                timeframeHtml += '</div>';
            }
            document.getElementById('timeframeResults').innerHTML = timeframeHtml;
        }
    </script>
</body>
</html>
