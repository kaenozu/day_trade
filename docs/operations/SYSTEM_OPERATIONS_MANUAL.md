# Day Trading System çµ±åˆã‚·ã‚¹ãƒ†ãƒ é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«

**çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œç‰ˆ** - 2025å¹´8æœˆç‰ˆ

---

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ã¯ã€Day Trading Systemã®æ—¥å¸¸é‹ç”¨ã€ç›£è¦–ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ‰‹é †ã‚’è©³ç´°ã«èª¬æ˜ã—ã¾ã™ã€‚çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’ä¸­å¿ƒã¨ã—ãŸåŒ…æ‹¬çš„ãªé‹ç”¨ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

### ğŸ¯ å¯¾è±¡èª­è€…
- **ã‚·ã‚¹ãƒ†ãƒ é‹ç”¨è€…**: æ—¥å¸¸ã®ç›£è¦–ãƒ»é‹ç”¨ä½œæ¥­æ‹…å½“è€…
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†è€…**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ã®å°‚é–€ä½œæ¥­æ‹…å½“è€…
- **ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…**: ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç®¡ç†æ‹…å½“è€…
- **é–‹ç™ºè€…**: ã‚·ã‚¹ãƒ†ãƒ ä¿®æ­£ãƒ»æ”¹è‰¯æ‹…å½“è€…

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
Day Trading System çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
â”œâ”€â”€ çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ PostgreSQL/SQLite æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ å¾©å…ƒãƒ»ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
â”‚   â””â”€â”€ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ»ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
â”œâ”€â”€ DDD (ãƒ‰ãƒ¡ã‚¤ãƒ³é§†å‹•è¨­è¨ˆ) ã‚³ã‚¢
â”‚   â”œâ”€â”€ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
â”‚   â”œâ”€â”€ å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”œâ”€â”€ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â””â”€â”€ é›†ç´„ãƒ«ãƒ¼ãƒˆ
â”œâ”€â”€ çµ±åˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 
â”œâ”€â”€ çµ±åˆãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
â””â”€â”€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | èª¬æ˜ | é…ç½® |
|---------------|------|------|
| **çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼** | æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã®ä¸­å¿ƒ | `src/day_trade/infrastructure/database/` |
| **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ ** | è‡ªå‹•ãƒ»æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ | `src/day_trade/infrastructure/database/backup_manager.py` |
| **ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ** | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ | `src/day_trade/infrastructure/database/monitoring_system.py` |
| **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰** | å¯è¦–åŒ–ãƒ»ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ | `src/day_trade/infrastructure/database/dashboard.py` |
| **å¾©å…ƒã‚·ã‚¹ãƒ†ãƒ ** | ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã®å¾©å…ƒæ©Ÿèƒ½ | `src/day_trade/infrastructure/database/restore_manager.py` |

---

## ğŸ“… æ—¥å¸¸é‹ç”¨ä½œæ¥­

### æœã®é‹ç”¨ç¢ºèª (æ¯æ—¥ 9:00)

#### 1. ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª

```bash
# ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“çŠ¶æ…‹ç¢ºèª
cd /opt/daytrading
source venv/bin/activate
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
manager = get_unified_database_manager()
if manager:
    status = manager.get_system_status()
    print(f'ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹: {status[\"overall_health\"]}')
    print(f'ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ•°: {len(status[\"components\"])}')
    print(f'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒˆ: {len(manager.get_active_alerts())}ä»¶')
else:
    print('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼')
"
```

#### 2. å¤œé–“ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª

```bash
# å¤œé–“ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å®Ÿè¡ŒçŠ¶æ³ç¢ºèª
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
manager = get_unified_database_manager()
if manager:
    backups = manager.list_backups()
    if backups:
        latest = backups[0]
        print(f'æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: {latest[\"filename\"]}')
        print(f'ã‚µã‚¤ã‚º: {latest[\"size_mb\"]}MB')
        print(f'ä½œæˆæ™‚åˆ»: {latest[\"created_at\"]}')
        print(f'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {latest[\"status\"]}')
    else:
        print('âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
"
```

#### 3. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª

```bash
# éå»24æ™‚é–“ã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª
tail -n 100 logs/production/errors.jsonl | jq -r '.timestamp + \" [\" + .level + \"] \" + .message'

# é‡è¦ãªã‚¨ãƒ©ãƒ¼ã®ã‚«ã‚¦ãƒ³ãƒˆ
grep -c "ERROR\|CRITICAL" logs/production/production.log
```

#### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çŠ¶æ³ç¢ºèª

```bash
# ç¾åœ¨ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç¢ºèª
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
manager = get_unified_database_manager()
if manager:
    metrics = manager.get_current_metrics()
    if metrics:
        print(f'CPUä½¿ç”¨ç‡: {metrics[\"cpu_usage\"]}%')
        print(f'ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: {metrics[\"memory_usage_mb\"]}MB')
        print(f'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šæ•°: {metrics[\"active_connections\"]}')
        print(f'æ¥ç¶šãƒ—ãƒ¼ãƒ«ä½¿ç”¨ç‡: {metrics[\"connection_pool_usage\"]:.1%}')
    else:
        print('ãƒ¡ãƒˆãƒªã‚¯ã‚¹å–å¾—å¤±æ•—')
"
```

---

### æ˜¼ã®é‹ç”¨ç¢ºèª (æ¯æ—¥ 13:00)

#### 1. ãƒˆãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‡¦ç†çŠ¶æ³ç¢ºèª

```bash
# å–å¼•å‡¦ç†çŠ¶æ³ã®ç¢ºèª
python -c "
import sqlite3
from datetime import datetime, timedelta

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
conn = sqlite3.connect('data/production/trading.db')
cursor = conn.cursor()

# ä»Šæ—¥ã®å–å¼•çµ±è¨ˆ
today = datetime.now().strftime('%Y-%m-%d')
cursor.execute('''
    SELECT COUNT(*) as trade_count,
           AVG(execution_time) as avg_time,
           SUM(profit_loss) as total_pnl
    FROM trades
    WHERE DATE(created_at) = ?
''', (today,))

result = cursor.fetchone()
print(f'æœ¬æ—¥ã®å–å¼•æ•°: {result[0]}')
print(f'å¹³å‡å®Ÿè¡Œæ™‚é–“: {result[1]:.2f}ç§’')
print(f'ç´¯è¨ˆæç›Š: {result[2]:.2f}å††')

conn.close()
"
```

#### 2. MLåˆ†æãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª

```bash
# MLåˆ†æå‡¦ç†æ™‚é–“ã®ç¢ºèª
grep "MLåˆ†æå®Œäº†" logs/production/application.jsonl | tail -5 | jq -r '.analysis_duration_seconds'
```

---

### å¤•æ–¹ã®é‹ç”¨ç¢ºèª (æ¯æ—¥ 17:00)

#### 1. æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª

```bash
# æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã¨ç¢ºèª
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
manager = get_unified_database_manager()
if manager:
    report = manager.generate_report()
    print(f'ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ: {report[\"status\"]}')
    if report[\"status\"] == 'success':
        print(f'ãƒ•ã‚¡ã‚¤ãƒ«: {report[\"file_path\"]}')
        print(f'ãƒ‡ãƒ¼ã‚¿æœŸé–“: {report[\"period\"]}')
"
```

#### 2. ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ç¢ºèª

```bash
# ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ç¢ºèª
df -h /opt/daytrading

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç¢ºèª
du -sh data/production/
du -sh logs/production/
du -sh backups/
```

#### 3. æ¥ç¶šãƒ—ãƒ¼ãƒ«çŠ¶æ³ç¢ºèª

```bash
# æ¥ç¶šãƒ—ãƒ¼ãƒ«è©³ç´°çŠ¶æ³
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
manager = get_unified_database_manager()
if manager and manager.production_db_manager:
    health = manager.production_db_manager.health_check()
    pool_status = health.get('pool_status', {})
    print(f'ãƒ—ãƒ¼ãƒ«ã‚µã‚¤ã‚º: {pool_status.get(\"size\", 0)}')
    print(f'ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆä¸­: {pool_status.get(\"checked_out\", 0)}')
    print(f'ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼: {pool_status.get(\"overflow\", 0)}')
    print(f'ä½¿ç”¨ç‡: {pool_status.get(\"utilization\", 0):.1%}')
"
```

---

## ğŸ“Š ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆç®¡ç†

### ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèª

#### ç¾åœ¨ã®ã‚¢ãƒ©ãƒ¼ãƒˆçŠ¶æ³

```bash
# ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒˆä¸€è¦§
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
manager = get_unified_database_manager()
if manager:
    alerts = manager.get_active_alerts()
    if alerts:
        print(f'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒˆ: {len(alerts)}ä»¶')
        for alert in alerts:
            print(f'- {alert[\"severity\"]}: {alert[\"message\"]}')
    else:
        print('ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒˆãªã—')
"
```

#### ã‚¢ãƒ©ãƒ¼ãƒˆçµ±è¨ˆæƒ…å ±

```bash
# ã‚¢ãƒ©ãƒ¼ãƒˆçµ±è¨ˆ
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
manager = get_unified_database_manager()
if manager and manager.monitoring_system:
    stats = manager.monitoring_system.get_alert_statistics()
    print(f'ç·ã‚¢ãƒ©ãƒ¼ãƒˆæ•°: {stats[\"total_alerts\"]}')
    print(f'Critical: {stats[\"critical_count\"]}ä»¶')
    print(f'Warning: {stats[\"warning_count\"]}ä»¶')
    print(f'Info: {stats[\"info_count\"]}ä»¶')
"
```

### ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œæ‰‹é †

#### Critical ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œ

1. **ã‚·ã‚¹ãƒ†ãƒ åœæ­¢**: ç·Šæ€¥æ™‚ã¯ã‚·ã‚¹ãƒ†ãƒ ã‚’å®‰å…¨ã«åœæ­¢
   ```bash
   sudo systemctl stop daytrading
   ```

2. **ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ**:
   ```bash
   python -c "
   from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
   manager = get_unified_database_manager()
   if manager:
       result = manager.create_backup('emergency')
       print(f'ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: {result[\"status\"]}')
   "
   ```

3. **å•é¡Œåˆ†æ**: ãƒ­ã‚°ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’ç¢ºèª
4. **å¾©æ—§ä½œæ¥­**: å•é¡Œã«å¿œã˜ãŸå¾©æ—§æ‰‹é †å®Ÿè¡Œ
5. **ã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•**: å•é¡Œè§£æ±ºå¾Œã«ã‚·ã‚¹ãƒ†ãƒ å†é–‹

#### Warning ã‚¢ãƒ©ãƒ¼ãƒˆå¯¾å¿œ

1. **è©³ç´°èª¿æŸ»**: ãƒ¡ãƒˆãƒªã‚¯ã‚¹å±¥æ­´ã‚’ç¢ºèª
2. **äºˆé˜²çš„æªç½®**: å¿…è¦ã«å¿œã˜ã¦ãƒªã‚½ãƒ¼ã‚¹èª¿æ•´
3. **ç¶™ç¶šç›£è¦–**: çŠ¶æ³ã®æ¨ç§»ã‚’è¦³å¯Ÿ

---

## ğŸ”§ é€±æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä½œæ¥­

### æ¯é€±æœˆæ›œæ—¥ (10:00)

#### 1. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ

```bash
# éå»1é€±é–“ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸€è¦§ç¢ºèª
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
from datetime import datetime, timedelta

manager = get_unified_database_manager()
if manager:
    backups = manager.list_backups()
    week_ago = datetime.now() - timedelta(days=7)

    recent_backups = [
        b for b in backups
        if datetime.fromisoformat(b['created_at']) >= week_ago
    ]

    print(f'éå»1é€±é–“ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: {len(recent_backups)}ä»¶')
    for backup in recent_backups:
        print(f'- {backup[\"filename\"]}: {backup[\"size_mb\"]}MB ({backup[\"status\"]})')
"

# æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®æ•´åˆæ€§ãƒ†ã‚¹ãƒˆï¼ˆãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼‰
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
manager = get_unified_database_manager()
if manager:
    backups = manager.list_backups()
    if backups:
        latest = backups[0]['filename']
        result = manager.restore_database(latest, dry_run=True)
        print(f'æ•´åˆæ€§ãƒ†ã‚¹ãƒˆ: {result[\"status\"]}')
"
```

#### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ

```bash
# é€±æ¬¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
from datetime import datetime, timedelta

manager = get_unified_database_manager()
if manager and manager.monitoring_system:
    # éå»1é€±é–“ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹å–å¾—
    metrics_history = manager.monitoring_system.get_metrics_history(hours=168)  # 7æ—¥

    if metrics_history:
        cpu_avg = sum(m['cpu_usage'] for m in metrics_history) / len(metrics_history)
        memory_avg = sum(m['memory_usage_mb'] for m in metrics_history) / len(metrics_history)

        print(f'éå»1é€±é–“ã®å¹³å‡:')
        print(f'- CPUä½¿ç”¨ç‡: {cpu_avg:.1f}%')
        print(f'- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: {memory_avg:.1f}MB')
        print(f'- ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆæ•°: {len(metrics_history)}')
"
```

#### 3. ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª

```bash
# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç¢ºèª
du -sh logs/production/*.log
du -sh logs/production/*.jsonl

# å¤ã„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®åœ§ç¸®ãƒ»å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸Šï¼‰
find logs/production/ -name "*.log.*" -mtime +30 -exec gzip {} \;
find logs/production/ -name "*.log.*.gz" -mtime +90 -delete
```

---

### æ¯é€±é‡‘æ›œæ—¥ (16:00)

#### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

```bash
# PostgreSQLçµ±è¨ˆæƒ…å ±æ›´æ–°ãƒ»ãƒã‚­ãƒ¥ãƒ¼ãƒ 
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
from sqlalchemy import text

manager = get_unified_database_manager()
if manager and manager.production_db_manager:
    with manager.production_db_manager.get_session() as session:
        # çµ±è¨ˆæƒ…å ±æ›´æ–°
        session.execute(text('ANALYZE;'))
        print('çµ±è¨ˆæƒ…å ±æ›´æ–°å®Œäº†')

        # ãƒã‚­ãƒ¥ãƒ¼ãƒ ï¼ˆè»½é‡ç‰ˆï¼‰
        session.execute(text('VACUUM (ANALYZE);'))
        print('ãƒã‚­ãƒ¥ãƒ¼ãƒ å®Œäº†')
"
```

#### 2. é€±æ¬¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ç¢ºèª
find /opt/daytrading -type f -name "*.py" ! -perm 644 -ls
find /opt/daytrading -type f -name "*.yaml" ! -perm 600 -ls

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ©Ÿå¯†æƒ…å ±ç¢ºèª
grep -n "password\|secret\|key" config/production/*.yaml | grep -v "environment_variable"
```

---

## ğŸ” æœˆæ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä½œæ¥­

### æ¯æœˆç¬¬1å–¶æ¥­æ—¥

#### 1. åŒ…æ‹¬çš„ã‚·ã‚¹ãƒ†ãƒ åˆ†æ

```bash
# ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®å¥å…¨æ€§ãƒ¬ãƒãƒ¼ãƒˆ
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
import json

manager = get_unified_database_manager()
if manager:
    # ç·åˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    health = manager.run_health_check()

    # ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ³ã‚µãƒãƒªãƒ¼
    status = manager.get_system_status()

    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æƒ…å ±
    db_info = manager.production_db_manager.get_database_info()

    print('=== æœˆæ¬¡ã‚·ã‚¹ãƒ†ãƒ åˆ†æãƒ¬ãƒãƒ¼ãƒˆ ===')
    print(f'ç·åˆãƒ˜ãƒ«ã‚¹: {health[\"overall_status\"]}')
    print(f'ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒç‡: {status[\"overall_health\"]}')
    print(f'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚º: {db_info.get(\"database_size\", \"ä¸æ˜\")}')
    print(f'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šæ•°: {db_info.get(\"active_connections\", 0)}')
"
```

#### 2. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒæœŸé–“ç®¡ç†

```bash
# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å‰Šé™¤ï¼ˆ30æ—¥ä»¥ä¸Šï¼‰
find backups/ -name "*.gz" -mtime +30 -delete
find backups/ -name "*.sql" -mtime +7 -delete  # æœªåœ§ç¸®ã¯7æ—¥

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®¹é‡ä½¿ç”¨çŠ¶æ³
du -sh backups/
df -h /opt/daytrading/backups
```

#### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãƒ¬ãƒ“ãƒ¥ãƒ¼

```bash
# æœˆæ¬¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ
python scripts/monthly_performance_report.py

# ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªåˆ†æ
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager

manager = get_unified_database_manager()
if manager and manager.monitoring_system:
    # ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªæƒ…å ±å–å¾—
    metrics = manager.monitoring_system.get_current_metrics()
    if metrics:
        print(f'ã‚¹ãƒ­ãƒ¼ã‚¯ã‚¨ãƒªæ•°: {metrics.get(\"slow_queries_count\", 0)}')
"
```

---

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œ

### ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•å¤±æ•—

#### ç—‡çŠ¶
```
sudo systemctl start daytrading
# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: failed
```

#### å¯¾å¿œæ‰‹é †
1. **ãƒ­ã‚°ç¢ºèª**:
   ```bash
   sudo journalctl -u daytrading -n 50
   tail -f logs/production/production.log
   ```

2. **è¨­å®šç¢ºèª**:
   ```bash
   # ç’°å¢ƒå¤‰æ•°ç¢ºèª
   cat .env

   # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹æ–‡ç¢ºèª
   python -c "import yaml; yaml.safe_load(open('config/production/database.yaml'))"
   ```

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª**:
   ```bash
   sudo systemctl status postgresql

   # æ¥ç¶šãƒ†ã‚¹ãƒˆ
   python -c "
   from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
   try:
       manager = get_unified_database_manager()
       health = manager.production_db_manager.health_check()
       print(f'DBæ¥ç¶š: {health[\"status\"]}')
   except Exception as e:
       print(f'DBæ¥ç¶šã‚¨ãƒ©ãƒ¼: {e}')
   "
   ```

### ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼

#### ç—‡çŠ¶
```
OutOfMemoryError: Cannot allocate memory
```

#### å¯¾å¿œæ‰‹é †
1. **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèª**:
   ```bash
   free -h
   ps aux | sort -nrk 4 | head -10
   ```

2. **è¨­å®šèª¿æ•´**:
   ```yaml
   # config/production/database.yaml
   database:
     pool_size: 10        # 20ã‹ã‚‰å‰Šæ¸›
     max_overflow: 15     # 30ã‹ã‚‰å‰Šæ¸›
   ```

3. **ã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•**:
   ```bash
   sudo systemctl restart daytrading
   ```

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¤±æ•—

#### ç—‡çŠ¶
```
Backup creation failed: No space left on device
```

#### å¯¾å¿œæ‰‹é †
1. **ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ç¢ºèª**:
   ```bash
   df -h /opt/daytrading/backups
   ```

2. **å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤**:
   ```bash
   # 30æ—¥ä»¥ä¸Šå¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤
   find backups/ -name "*.gz" -mtime +30 -delete
   ```

3. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å†å®Ÿè¡Œ**:
   ```bash
   python -c "
   from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
   manager = get_unified_database_manager()
   result = manager.create_backup('manual_recovery')
   print(f'ãƒªã‚«ãƒãƒªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: {result[\"status\"]}')
   "
   ```

---

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

#### å®šæœŸå®Ÿè¡Œæ¨å¥¨ï¼ˆæœˆ1å›ï¼‰

```bash
# PostgreSQLæœ€é©åŒ–ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
python -c "
from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
from sqlalchemy import text

manager = get_unified_database_manager()
if manager and manager.production_db_manager:
    with manager.production_db_manager.get_session() as session:
        # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰
        session.execute(text('REINDEX DATABASE daytrading_prod;'))
        print('ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å†æ§‹ç¯‰å®Œäº†')

        # å®Œå…¨ãƒã‚­ãƒ¥ãƒ¼ãƒ ï¼ˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚é–“ä¸­ã®ã¿ï¼‰
        session.execute(text('VACUUM FULL ANALYZE;'))
        print('å®Œå…¨ãƒã‚­ãƒ¥ãƒ¼ãƒ å®Œäº†')
"
```

### æ¥ç¶šãƒ—ãƒ¼ãƒ«èª¿æ•´

#### é«˜è² è·æ™‚ã®è¨­å®š

```yaml
# config/production/database.yaml ï¼ˆé«˜è² è·å¯¾å¿œï¼‰
database:
  pool_size: 30
  max_overflow: 50
  pool_timeout: 60
  pool_recycle: 1800
```

#### å®‰å®šæ€§é‡è¦–ã®è¨­å®š

```yaml
# config/production/database.yaml ï¼ˆå®‰å®šæ€§é‡è¦–ï¼‰
database:
  pool_size: 15
  max_overflow: 25
  pool_timeout: 30
  pool_recycle: 3600
```

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é‹ç”¨

### æ—¥æ¬¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

```bash
# ä¸å¯©ãªãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œç¢ºèª
grep "authentication failed" logs/production/production.log | tail -10

# ãƒ•ã‚¡ã‚¤ãƒ«æ”¹ã–ã‚“ç¢ºèªï¼ˆé‡è¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
find config/ -type f -mtime -1 -ls
find src/day_trade/infrastructure/ -type f -mtime -1 -ls
```

### é€±æ¬¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°

```bash
# ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ›´æ–°
sudo apt update && sudo apt list --upgradable

# Pythonä¾å­˜é–¢ä¿‚ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºèª
pip-audit
```

---

## ğŸ“‹ é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèªï¼ˆ9:00ï¼‰
- [ ] å¤œé–“ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çŠ¶æ³ç¢ºèª
- [ ] æ˜¼ã®ãƒˆãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‡¦ç†ç¢ºèªï¼ˆ13:00ï¼‰
- [ ] MLåˆ†æãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèª
- [ ] æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç¢ºèªï¼ˆ17:00ï¼‰
- [ ] ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ç¢ºèª
- [ ] æ¥ç¶šãƒ—ãƒ¼ãƒ«çŠ¶æ³ç¢ºèª

### é€±æ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ•´åˆæ€§ãƒ†ã‚¹ãƒˆï¼ˆæœˆæ›œï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
- [ ] ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèª
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–ï¼ˆé‡‘æ›œï¼‰
- [ ] é€±æ¬¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

### æœˆæ¬¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] åŒ…æ‹¬çš„ã‚·ã‚¹ãƒ†ãƒ åˆ†æ
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿æŒæœŸé–“ç®¡ç†
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°é©ç”¨
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«è¦‹ç›´ã—

---

## ğŸ“ ç·Šæ€¥æ™‚é€£çµ¡æ‰‹é †

### ç·Šæ€¥äº‹æ…‹ã®å®šç¾©

1. **ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨åœæ­¢**
2. **ãƒ‡ãƒ¼ã‚¿æå¤±ã®å¯èƒ½æ€§**
3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ**
4. **å–å¼•å‡¦ç†ç•°å¸¸**

### ç·Šæ€¥æ™‚å¯¾å¿œæ‰‹é †

1. **å³åº§ã«å®Ÿè¡Œ**:
   ```bash
   # ã‚·ã‚¹ãƒ†ãƒ åœæ­¢
   sudo systemctl stop daytrading

   # ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
   python -c "
   from src.day_trade.infrastructure.database.unified_database_manager import get_unified_database_manager
   manager = get_unified_database_manager()
   if manager:
       result = manager.create_backup('emergency_' + datetime.now().strftime('%Y%m%d_%H%M%S'))
       print(f'ç·Šæ€¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: {result}')
   "
   ```

2. **çŠ¶æ³è¨˜éŒ²**:
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
   - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼
   - ç™ºç”Ÿæ™‚åˆ»ã®æ­£ç¢ºãªè¨˜éŒ²

3. **å¾©æ—§ä½œæ¥­**:
   - å•é¡Œã®åˆ†æã¨ç‰¹å®š
   - å¿…è¦ã«å¿œã˜ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰ã®å¾©å…ƒ
   - ã‚·ã‚¹ãƒ†ãƒ ã®æ®µéšçš„å¾©æ—§

---

**ã“ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã¯çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®‰å®šé‹ç”¨ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªã‚¬ã‚¤ãƒ‰ã§ã™ã€‚å®šæœŸçš„ãªæ›´æ–°ã¨å®Ÿéš›ã®é‹ç”¨çµŒé¨“ã«åŸºã¥ãæ”¹å–„ã‚’ç¶™ç¶šã—ã¦ãã ã•ã„ã€‚**

---

*æœ€çµ‚æ›´æ–°: 2025å¹´8æœˆ18æ—¥*  
*ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.0 (çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œ)*