# æ‹¡å¼µã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰

Day Trade CLIã®æ‹¡å¼µã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã¯ã€ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã€ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ã€è‰²åˆ†ã‘è¡¨ç¤ºãªã©ã®é«˜åº¦ãªæ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

## æ©Ÿèƒ½æ¦‚è¦

### ğŸš€ ä¸»è¦æ©Ÿèƒ½

1. **ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆæ©Ÿèƒ½**
   - ã‚³ãƒãƒ³ãƒ‰åã€å¼•æ•°ã€éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã®è‡ªå‹•è£œå®Œ
   - Tabã‚­ãƒ¼ã§ã®å€™è£œè¡¨ç¤º
   - ã‚ã„ã¾ã„æ¤œç´¢å¯¾å¿œ

2. **ã‚³ãƒãƒ³ãƒ‰å±¥æ­´**
   - éå»ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä¿å­˜ãƒ»å‘¼ã³å‡ºã—
   - ä¸Šä¸‹çŸ¢å°ã‚­ãƒ¼ã§ã®å±¥æ­´ç§»å‹•
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³é–“ã§ã®å±¥æ­´æ°¸ç¶šåŒ–

3. **è‰²åˆ†ã‘ã¨ãƒã‚¤ãƒ©ã‚¤ãƒˆ**
   - ã‚³ãƒãƒ³ãƒ‰ã®æ§‹æ–‡å¼·èª¿
   - ã‚¨ãƒ©ãƒ¼ãƒ»æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è‰²åˆ†ã‘
   - è¦‹ã‚„ã™ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¡¨ç¤º

4. **ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°**
   - `Ctrl+C`: çµ‚äº†ç¢ºèª
   - `Ctrl+L`: ç”»é¢ã‚¯ãƒªã‚¢
   - `F1`: ãƒ˜ãƒ«ãƒ—è¡¨ç¤º

5. **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¯¾å¿œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ**
   - ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
   - æ™‚åˆ»è¡¨ç¤º
   - å‹•çš„ãªãƒ„ãƒ¼ãƒ«ãƒãƒ¼

## ä½¿ç”¨æ–¹æ³•

### èµ·å‹•æ–¹æ³•

#### 1. ãƒ¡ã‚¤ãƒ³ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰èµ·å‹•
```bash
python daytrade.py --interactive
# ã¾ãŸã¯
python daytrade.py -i
```

#### 2. ç›´æ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰èµ·å‹•
```bash
python -m src.day_trade.cli.enhanced_interactive
```

#### 3. CLIã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰èµ·å‹•
```bash
python -m src.day_trade.cli.interactive enhanced
```

### å¿…è¦ãªä¾å­˜é–¢ä¿‚

æ‹¡å¼µã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ä¾å­˜é–¢ä¿‚ãŒå¿…è¦ã§ã™ï¼š

```bash
pip install prompt_toolkit>=3.0.0
```

ä¾å­˜é–¢ä¿‚ã¯æ—¢ã« `requirements.txt` ã¨ `setup.py` ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€é€šå¸¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§è‡ªå‹•çš„ã«å«ã¾ã‚Œã¾ã™ã€‚

## åˆ©ç”¨å¯èƒ½ã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ | ä¾‹ |
|---------|-----|---|
| `help` | ãƒ˜ãƒ«ãƒ—è¡¨ç¤º | `help` |
| `stock <ã‚³ãƒ¼ãƒ‰>` | å€‹åˆ¥éŠ˜æŸ„æƒ…å ± | `stock 7203` |
| `history <ã‚³ãƒ¼ãƒ‰>` | ãƒ’ã‚¹ãƒˆãƒªã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ | `history 7203` |
| `watch <ã‚³ãƒ¼ãƒ‰...>` | è¤‡æ•°éŠ˜æŸ„ç›£è¦– | `watch 7203 9984` |
| `exit` / `quit` | çµ‚äº† | `exit` |

### ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆç®¡ç†

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ | ä¾‹ |
|---------|-----|---|
| `watchlist add <ã‚³ãƒ¼ãƒ‰>` | è¿½åŠ  | `watchlist add 7203` |
| `watchlist remove <ã‚³ãƒ¼ãƒ‰>` | å‰Šé™¤ | `watchlist remove 7203` |
| `watchlist list` | ä¸€è¦§è¡¨ç¤º | `watchlist list` |
| `watchlist clear` | å…¨å‰Šé™¤ | `watchlist clear` |

### è¨­å®šç®¡ç†

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ | ä¾‹ |
|---------|-----|---|
| `config show` | è¨­å®šè¡¨ç¤º | `config show` |
| `config set <ã‚­ãƒ¼> <å€¤>` | è¨­å®šå¤‰æ›´ | `config set api.timeout 30` |
| `config reset` | ãƒªã‚»ãƒƒãƒˆ | `config reset` |

### ãã®ä»–

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ | ä¾‹ |
|---------|-----|---|
| `validate <ã‚³ãƒ¼ãƒ‰...>` | éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰æ¤œè¨¼ | `validate 7203 9984` |
| `backtest` | ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ | `backtest` |

## ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°

| ã‚­ãƒ¼ | æ©Ÿèƒ½ |
|-----|-----|
| `Tab` | ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆ |
| `â†‘` / `â†“` | ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ |
| `Ctrl+C` | çµ‚äº†ç¢ºèª |
| `Ctrl+L` | ç”»é¢ã‚¯ãƒªã‚¢ |
| `F1` | ãƒ˜ãƒ«ãƒ—è¡¨ç¤º |
| `Ctrl+R` | å±¥æ­´æ¤œç´¢ |

## ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆå¯¾å¿œé …ç›®

### éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰
- ä¸»è¦æ—¥æœ¬æ ªã®éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰
- ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆã®éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰
- å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„æ¤œç´¢

### ã‚³ãƒãƒ³ãƒ‰éšå±¤
```
stock <éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰>
history <éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰>
watch <éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰...>
watchlist
  â”œâ”€â”€ add <éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰>
  â”œâ”€â”€ remove <éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰>
  â”œâ”€â”€ list
  â”œâ”€â”€ clear
  â”œâ”€â”€ memo <éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰>
  â””â”€â”€ move <éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰>
config
  â”œâ”€â”€ show
  â”œâ”€â”€ set
  â”‚   â”œâ”€â”€ api.timeout
  â”‚   â”œâ”€â”€ trading.commission
  â”‚   â””â”€â”€ display.theme [dark|light]
  â””â”€â”€ reset
validate <éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰...>
backtest
```

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

### å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«
ã‚³ãƒãƒ³ãƒ‰å±¥æ­´ã¯ä»¥ä¸‹ã®å ´æ‰€ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼š
- Windows: `C:\Users\{username}\.daytrade_history`
- Linux/Mac: `~/.daytrade_history`

### è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
`EnhancedInteractiveCLI` ã‚¯ãƒ©ã‚¹ã§ä»¥ä¸‹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ï¼š

```python
# ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
self.style = Style.from_dict({
    'completion-menu.completion': 'bg:#008888 #ffffff',
    'completion-menu.completion.current': 'bg:#00aaaa #000000',
    'prompt': '#884444 bold',
    'input': '#ffffff',
})

# éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã®æ‹¡å¼µ
self.stock_codes.extend(['æ–°ã—ã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰'])
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### prompt_toolkitãŒè¦‹ã¤ã‹ã‚‰ãªã„
```bash
âŒ ã‚¨ãƒ©ãƒ¼: æ‹¡å¼µã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚
prompt_toolkit>=3.0.0 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚
```

**è§£æ±ºæ–¹æ³•:**
```bash
pip install prompt_toolkit>=3.0.0
```

### å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™ã‚¨ãƒ©ãƒ¼
å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
```bash
# Linux/Mac
chmod 644 ~/.daytrade_history

# Windows
# ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰æ¨©é™ã‚’ç¢ºèª
```

### ã‚ªãƒ¼ãƒˆã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆãŒå‹•ä½œã—ãªã„
- Tabã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„
- ã‚³ãƒãƒ³ãƒ‰ã®éšå±¤æ§‹é€ ã‚’ç¢ºèªã—ã¦ãã ã•ã„
- å¤§æ–‡å­—å°æ–‡å­—ã¯åŒºåˆ¥ã•ã‚Œã¾ã›ã‚“

## é–‹ç™ºè€…å‘ã‘æƒ…å ±

### æ–°ã—ã„ã‚³ãƒãƒ³ãƒ‰ã®è¿½åŠ 
`enhanced_interactive.py` ã® `_create_command_completer()` ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚³ãƒãƒ³ãƒ‰éšå±¤ã‚’å®šç¾©ï¼š

```python
return NestedCompleter.from_nested_dict({
    'new_command': {
        'subcommand': WordCompleter(['option1', 'option2']),
    }
})
```

### æ–°ã—ã„éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã®è¿½åŠ 
`_load_stock_codes()` ãƒ¡ã‚½ãƒƒãƒ‰ã§éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’ç®¡ç†ï¼š

```python
def _load_stock_codes(self) -> List[str]:
    common_codes = ["7203", "9984", ...]  # æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
    return common_codes
```

### ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®è¿½åŠ 
`_setup_key_bindings()` ãƒ¡ã‚½ãƒƒãƒ‰ã§æ–°ã—ã„ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®šç¾©ï¼š

```python
@self.bindings.add('f2')
def _(event):
    """F2 ã§æ–°ã—ã„æ©Ÿèƒ½"""
    self._new_function()
```

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

- [ ] éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ã®å‹•çš„å–å¾—
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒæ©Ÿèƒ½
- [ ] ãƒã‚¯ãƒ­æ©Ÿèƒ½
- [ ] å¤šè¨€èªå¯¾å¿œ
- [ ] ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
