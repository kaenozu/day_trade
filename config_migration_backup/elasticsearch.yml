#==============================================================================
# Elasticsearch è¨­å®š - Issue #442 Phase 2
# é«˜æ€§èƒ½ãƒ­ã‚°ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ»æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³è¨­å®š
#==============================================================================

# === ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼è¨­å®š ===
cluster.name: day-trade-observability
node.name: elasticsearch-apm-node
node.roles: [master, data, ingest, ml]

# === ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š ===
network.host: 0.0.0.0
http.port: 9200
transport.port: 9300

# === ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼è¨­å®š ===
discovery.type: single-node
cluster.initial_master_nodes: ["elasticsearch-apm-node"]

# === ãƒ¡ãƒ¢ãƒªè¨­å®š ===
bootstrap.memory_lock: true
indices.memory.index_buffer_size: 20%
indices.memory.min_index_buffer_size: 96mb

# === ãƒ‡ã‚£ã‚¹ã‚¯è¨­å®š ===
cluster.routing.allocation.disk.threshold_enabled: true
cluster.routing.allocation.disk.watermark.low: 85%
cluster.routing.allocation.disk.watermark.high: 90%
cluster.routing.allocation.disk.watermark.flood_stage: 95%

# === ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š ===
action.auto_create_index: true
action.destructive_requires_name: false

# === HFTå¯¾å¿œã®é«˜é€Ÿè¨­å®š ===

# æ¤œç´¢æ€§èƒ½æœ€é©åŒ–
index.search.idle.after: 30s
index.refresh_interval: 5s  # HFTç”¨ã®é«˜é »åº¦æ›´æ–°
index.translog.flush_threshold_size: 1gb
index.translog.sync_interval: 30s

# æ›¸ãè¾¼ã¿æ€§èƒ½æœ€é©åŒ–
index.number_of_shards: 3
index.number_of_replicas: 1
index.write.wait_for_active_shards: 1

# === ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š ===
xpack.security.enabled: false  # é–‹ç™ºç’°å¢ƒç”¨ï¼ˆæœ¬ç•ªã§ã¯æœ‰åŠ¹åŒ–ï¼‰
xpack.security.enrollment.enabled: false
xpack.security.http.ssl.enabled: false
xpack.security.transport.ssl.enabled: false

# === ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°è¨­å®š ===
xpack.monitoring.collection.enabled: true
xpack.monitoring.collection.interval: 30s

# === Machine Learning è¨­å®š ===
xpack.ml.enabled: true
xpack.ml.max_open_jobs: 10
xpack.ml.max_machine_memory_percent: 30

# === ç•°å¸¸æ¤œçŸ¥è¨­å®š ===
xpack.ml.anomaly_detection.enabled: true

# === ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š ===
xpack.watcher.enabled: false  # æœ¬ç•ªã§ã¯æœ‰åŠ¹åŒ–

# === ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç† ===
xpack.ilm.enabled: true

# === ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æ•´ ===

# åŒæ™‚æ¤œç´¢ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
search.max_concurrent_shard_requests: 10

# æ¤œç´¢ã‚­ãƒ¥ãƒ¼è¨­å®š
thread_pool.search.queue_size: 10000
thread_pool.write.queue_size: 10000
thread_pool.analyze.queue_size: 16

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
indices.queries.cache.size: 20%
indices.fielddata.cache.size: 40%

# === ãƒ­ã‚°è¨­å®š ===
logger.level: WARN
logger.deprecation.level: WARN

# ç‰¹å®šã‚«ãƒ†ã‚´ãƒªã®ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«èª¿æ•´
logger.org.elasticsearch.indices.recovery: DEBUG
logger.org.elasticsearch.cluster.service: DEBUG

# === JVM ãƒ’ãƒ¼ãƒ—ãƒ€ãƒ³ãƒ—è¨­å®š ===
path.data: /usr/share/elasticsearch/data
path.logs: /usr/share/elasticsearch/logs
path.repo: ["/usr/share/elasticsearch/backups"]

# === HFTç‰¹åŒ–è¨­å®š ===

# ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·æ¤œç´¢ç”¨è¨­å®š
index.search.slowlog.threshold.query.warn: 10s
index.search.slowlog.threshold.query.info: 5s
index.search.slowlog.threshold.query.debug: 2s
index.search.slowlog.threshold.query.trace: 500ms

# é«˜é »åº¦æ›¸ãè¾¼ã¿æœ€é©åŒ–
index.indexing.slowlog.threshold.index.warn: 10s
index.indexing.slowlog.threshold.index.info: 5s
index.indexing.slowlog.threshold.index.debug: 2s
index.indexing.slowlog.threshold.index.trace: 200ms

# === ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼çŠ¶æ…‹æœ€é©åŒ– ===
cluster.max_shards_per_node: 3000
cluster.routing.allocation.enable: all
cluster.routing.rebalance.enable: all

# === åœ§ç¸®è¨­å®š ===
index.codec: best_compression

# === åˆ†æè¨­å®š ===
index.analysis.analyzer.default.type: standard
index.analysis.analyzer.default.stopwords: _english_

# === ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°æœ€é©åŒ– ===
index.mapping.total_fields.limit: 2000
index.mapping.depth.limit: 20
index.mapping.nested_fields.limit: 100

#==============================================================================
# Elasticsearch ç‰¹åŒ–æ©Ÿèƒ½:
#
# ğŸš€ HFTå¯¾å¿œé«˜é€Ÿè¨­å®š:
#   - 5ç§’é–“éš”ã§ã®é«˜é »åº¦ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
#   - æœ€é©åŒ–ã•ã‚ŒãŸã‚·ãƒ£ãƒ¼ãƒ‰ãƒ»ãƒ¬ãƒ—ãƒªã‚«æ§‹æˆ
#   - ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·æ¤œç´¢ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
#
# ğŸ’¾ å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†:
#   - åŠ¹ç‡çš„ãªåœ§ç¸®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
#   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†
#   - è‡ªå‹•ã‚·ãƒ£ãƒ¼ãƒ‰ç®¡ç†
#
# ğŸ” é«˜é€Ÿæ¤œç´¢æ©Ÿèƒ½:
#   - ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–
#   - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚­ãƒ£ãƒƒã‚·ãƒ¥
#   - ä¸¦åˆ—æ¤œç´¢å‡¦ç†
#
# ğŸ¤– æ©Ÿæ¢°å­¦ç¿’çµ±åˆ:
#   - ç•°å¸¸æ¤œçŸ¥æ©Ÿèƒ½
#   - ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
#   - äºˆæ¸¬çš„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹
#
# ğŸ“Š é‹ç”¨ç›£è¦–:
#   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹
#   - ã‚¹ãƒ­ãƒ¼ãƒ­ã‚°åˆ†æ
#   - ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼å¥å…¨æ€§ç›£è¦–
#==============================================================================