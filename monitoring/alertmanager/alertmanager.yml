# AlertManagerè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
# Day Trade ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆç®¡ç†

global:
  # SMTPè¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯ç’°å¢ƒå¤‰æ•°ã§è¨­å®šï¼‰
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@daytrading.local'
  smtp_auth_username: 'alerts@daytrading.local'
  smtp_auth_password: 'password'

# ã‚¢ãƒ©ãƒ¼ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default'

  # é‡è¦åº¦åˆ¥ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
  routes:
    # Critical: å³åº§é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m

    # High: 5åˆ†ä»¥å†…é€šçŸ¥
    - match:
        severity: high
      receiver: 'high-alerts'
      group_wait: 5m
      repeat_interval: 15m

    # Medium: é€šå¸¸é€šçŸ¥
    - match:
        severity: medium
      receiver: 'medium-alerts'

    # ãƒªã‚¹ã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å°‚ç”¨
    - match:
        service: risk-management
      receiver: 'risk-management-alerts'
      group_wait: 1s
      repeat_interval: 10m

# é€šçŸ¥å—ä¿¡è€…è¨­å®š
receivers:
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå—ä¿¡è€…
  - name: 'default'
    email_configs:
      - to: 'admin@daytrading.local'
        subject: '[Day Trade] {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          Alert: {{ .Annotations.summary }}
          Description: {{ .Annotations.description }}
          {{ end }}

  # Critical ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'critical-alerts'
    email_configs:
      - to: 'critical@daytrading.local,admin@daytrading.local'
        subject: 'ğŸš¨ [CRITICAL] Day Trade System Alert'
        body: |
          CRITICAL ALERT - Immediate Action Required

          {{ range .Alerts }}
          Service: {{ .Labels.service }}
          Alert: {{ .Annotations.summary }}
          Description: {{ .Annotations.description }}
          Severity: {{ .Labels.severity }}
          Time: {{ .StartsAt }}
          {{ end }}

    # Slacké€šçŸ¥ï¼ˆæœ¬ç•ªç’°å¢ƒç”¨ï¼‰
    # slack_configs:
    #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
    #     channel: '#critical-alerts'
    #     title: 'ğŸš¨ Critical Day Trade Alert'
    #     text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'

  # High priority ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'high-alerts'
    email_configs:
      - to: 'high@daytrading.local,admin@daytrading.local'
        subject: 'âš ï¸ [HIGH] Day Trade System Alert'
        body: |
          HIGH PRIORITY ALERT

          {{ range .Alerts }}
          Service: {{ .Labels.service }}
          Alert: {{ .Annotations.summary }}
          Description: {{ .Annotations.description }}
          Time: {{ .StartsAt }}
          {{ end }}

  # Medium priority ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'medium-alerts'
    email_configs:
      - to: 'medium@daytrading.local'
        subject: 'â„¹ï¸ [MEDIUM] Day Trade System Alert'

  # ãƒªã‚¹ã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å°‚ç”¨ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'risk-management-alerts'
    email_configs:
      - to: 'risk-team@daytrading.local,admin@daytrading.local'
        subject: 'âš–ï¸ [RISK] Day Trade Risk Management Alert'
        body: |
          RISK MANAGEMENT ALERT

          {{ range .Alerts }}
          Risk Component: {{ .Labels.component }}
          Alert: {{ .Annotations.summary }}
          Risk Level: {{ .Labels.risk_level }}
          Confidence: {{ .Labels.confidence }}
          Description: {{ .Annotations.description }}
          Time: {{ .StartsAt }}
          {{ end }}

# ã‚¢ãƒ©ãƒ¼ãƒˆæŠ‘åˆ¶ãƒ«ãƒ¼ãƒ«
inhibit_rules:
  # ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ€ã‚¦ãƒ³æ™‚ã¯ä»–ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶
  - source_match:
      alertname: InstanceDown
    target_match:
      job: day-trade-app
    equal: ['instance']

  # Critical ã‚¢ãƒ©ãƒ¼ãƒˆæ™‚ã¯Highä»¥ä¸‹ã‚’æŠ‘åˆ¶
  - source_match:
      severity: critical
    target_match_re:
      severity: high|medium|low
    equal: ['service', 'instance']
