name: Documentation Automation

on:
  push:
    branches: [main]
    paths:
      - 'src/**'
      - 'docs/**'
      - 'README.md'
      - 'pyproject.toml'
  pull_request:
    branches: [main]
    paths:
      - 'src/**'
      - 'docs/**'
      - 'README.md'
  release:
    types: [published]
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  generate-api-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      - name: Install documentation dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install sphinx sphinx-rtd-theme sphinx-autodoc-typehints
          pip install pdoc3 pydoc-markdown

      - name: Generate API documentation
        run: |
          mkdir -p docs/api

          # Sphinx„Å´„Çà„ÇãËá™Âãï„Éâ„Ç≠„É•„É°„É≥„ÉàÁîüÊàê
          sphinx-quickstart -q --sep \
            --project="Day Trade System" \
            --author="kaenozu" \
            --release="$(git describe --tags --always)" \
            --language="ja" \
            --extensions="sphinx.ext.autodoc,sphinx.ext.viewcode,sphinx.ext.napoleon,sphinx_autodoc_typehints" \
            docs/sphinx

          # conf.py„ÅÆË®≠ÂÆö
          cat >> docs/sphinx/source/conf.py << 'EOF'

          import os
          import sys
          sys.path.insert(0, os.path.abspath('../../../src'))

          html_theme = 'sphinx_rtd_theme'
          html_theme_options = {
              'canonical_url': '',
              'analytics_id': '',
              'logo_only': False,
              'display_version': True,
              'prev_next_buttons_location': 'bottom',
              'style_external_links': False,
              'vcs_pageview_mode': '',
              'style_nav_header_background': 'white',
              'collapse_navigation': True,
              'sticky_navigation': True,
              'navigation_depth': 4,
              'includehidden': True,
              'titles_only': False
          }

          autodoc_default_options = {
              'members': True,
              'member-order': 'bysource',
              'special-members': '__init__',
              'undoc-members': True,
              'exclude-members': '__weakref__'
          }
          EOF

          # „É¢„Ç∏„É•„Éº„É´ÊßãÈÄ†„ÇíÂàÜÊûê„Åó„Å¶rst„Éï„Ç°„Ç§„É´„ÇíÁîüÊàê
          python -c "
          import os
          import pkgutil
          import importlib
          import sys
          sys.path.insert(0, 'src')

          def generate_module_rst(module_name, output_dir):
              try:
                  module = importlib.import_module(module_name)

                  rst_content = f'''
          {module_name}
          {'=' * len(module_name)}

          .. automodule:: {module_name}
             :members:
             :undoc-members:
             :show-inheritance:
          '''

                  # „Çµ„Éñ„É¢„Ç∏„É•„Éº„É´„ÇÇÂê´„ÇÅ„Çã
                  if hasattr(module, '__path__'):
                      for importer, modname, ispkg in pkgutil.iter_modules(module.__path__, module.__name__ + '.'):
                          rst_content += f'''

          {modname}
          {'-' * len(modname)}

          .. automodule:: {modname}
             :members:
             :undoc-members:
             :show-inheritance:
          '''

                  os.makedirs(output_dir, exist_ok=True)
                  with open(f'{output_dir}/{module_name.replace(\".\", \"_\")}.rst', 'w') as f:
                      f.write(rst_content.strip())

                  return True
              except Exception as e:
                  print(f'Failed to generate docs for {module_name}: {e}')
                  return False

          # ‰∏ªË¶Å„Å™„É¢„Ç∏„É•„Éº„É´„ÅÆ„Éâ„Ç≠„É•„É°„É≥„ÉàÁîüÊàê
          modules = [
              'day_trade.ml',
              'day_trade.core',
              'day_trade.api',
              'day_trade.data',
              'day_trade.models',
              'day_trade.utils',
              'day_trade.analysis'
          ]

          for module in modules:
              generate_module_rst(module, 'docs/sphinx/source')

          # index.rst„ÅÆÊõ¥Êñ∞
          index_content = '''
          Day Trade System Documentation
          =============================

          Welcome to the Day Trade System documentation!

          .. toctree::
             :maxdepth: 2
             :caption: Contents:

             day_trade_ml
             day_trade_core
             day_trade_api
             day_trade_data
             day_trade_models
             day_trade_utils
             day_trade_analysis

          Indices and tables
          ==================

          * :ref:\`genindex\`
          * :ref:\`modindex\`
          * :ref:\`search\`
          '''

          with open('docs/sphinx/source/index.rst', 'w') as f:
              f.write(index_content.strip())
          "

          # Sphinx build
          cd docs/sphinx && make html

      - name: Generate README updates
        run: |
          # „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁµ±Ë®à„ÅÆÊõ¥Êñ∞
          python -c "
          import os
          import subprocess
          from datetime import datetime

          # „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁµ±Ë®à„ÅÆÂèéÈõÜ
          try:
              # „Éï„Ç°„Ç§„É´Êï∞
              py_files = subprocess.check_output(['find', 'src/', '-name', '*.py']).decode().strip().count('\n') + 1
              test_files = subprocess.check_output(['find', 'tests/', '-name', '*.py'], stderr=subprocess.DEVNULL).decode().strip().count('\n') if os.path.exists('tests') else 0

              # „Ç≥„Éº„ÉâË°åÊï∞
              lines_output = subprocess.check_output(['find', 'src/', '-name', '*.py', '-exec', 'wc', '-l', '{}', '+'], stderr=subprocess.DEVNULL).decode()
              total_lines = sum(int(line.strip().split()[0]) for line in lines_output.split('\n')[:-2] if line.strip())

              # GitÁµ±Ë®à
              commits = subprocess.check_output(['git', 'rev-list', '--count', 'HEAD']).decode().strip()

              # ÊúÄÊñ∞„É™„É™„Éº„Çπ
              latest_tag = subprocess.check_output(['git', 'describe', '--tags', '--abbrev=0'], stderr=subprocess.DEVNULL).decode().strip()

              stats = f'''
          ## üìä „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁµ±Ë®à

          - **Python„Éï„Ç°„Ç§„É´Êï∞**: {py_files}
          - **„ÉÜ„Çπ„Éà„Éï„Ç°„Ç§„É´Êï∞**: {test_files}
          - **Á∑è„Ç≥„Éº„ÉâË°åÊï∞**: {total_lines:,}
          - **Á∑è„Ç≥„Éü„ÉÉ„ÉàÊï∞**: {commits}
          - **ÊúÄÊñ∞„Éê„Éº„Ç∏„Éß„É≥**: {latest_tag}
          - **ÊúÄÁµÇÊõ¥Êñ∞**: {datetime.now().strftime('%Y-%m-%d')}
          '''

              # README„ÅÆÁµ±Ë®à„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÊõ¥Êñ∞
              with open('README.md', 'r', encoding='utf-8') as f:
                  content = f.read()

              # Êó¢Â≠ò„ÅÆÁµ±Ë®à„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÁΩÆÊèõ
              import re
              pattern = r'## üìä „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÁµ±Ë®à.*?(?=\n## |\n#[^#]|\Z)'

              if re.search(pattern, content, re.DOTALL):
                  content = re.sub(pattern, stats.strip(), content, flags=re.DOTALL)
              else:
                  content += '\n' + stats

              with open('README.md', 'w', encoding='utf-8') as f:
                  f.write(content)

              print('README.md updated with latest statistics')

          except Exception as e:
              print(f'Error updating README statistics: {e}')
          "

      - name: Generate machine learning model documentation
        run: |
          mkdir -p docs/ml

          python -c "
          import sys
          import json
          import inspect
          from datetime import datetime
          sys.path.insert(0, 'src')

          # Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´„ÅÆÊñáÊõ∏Âåñ
          try:
              from day_trade.ml.feature_pipeline import FeaturePipeline
              from day_trade.ml.feature_store import FeatureStore

              # ÁâπÂæ¥Èáè„Éë„Ç§„Éó„É©„Ç§„É≥„Éâ„Ç≠„É•„É°„É≥„Éà
              pipeline_doc = f'''
          # ü§ñ Ê©üÊ¢∞Â≠¶Áøí„É¢„Éá„É´„Éâ„Ç≠„É•„É°„É≥„Éà

          **ÁîüÊàêÊó•ÊôÇ**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

          ## ÁâπÂæ¥Èáè„Éë„Ç§„Éó„É©„Ç§„É≥

          ### FeaturePipeline „ÇØ„É©„Çπ

          {inspect.getdoc(FeaturePipeline) or '„Éâ„Ç≠„É•„É°„É≥„Éà„Å™„Åó'}

          #### ‰∏ªË¶Å„É°„ÇΩ„ÉÉ„Éâ
          '''

              # „ÇØ„É©„Çπ„ÅÆ„É°„ÇΩ„ÉÉ„Éâ„ÇíÊñáÊõ∏Âåñ
              for name, method in inspect.getmembers(FeaturePipeline, predicate=inspect.isfunction):
                  if not name.startswith('_'):
                      doc = inspect.getdoc(method) or '„Éâ„Ç≠„É•„É°„É≥„Éà„Å™„Åó'
                      signature = inspect.signature(method)
                      pipeline_doc += f'''

          ##### {name}{signature}

          {doc}
          '''

              # ÁâπÂæ¥Èáè„Çπ„Éà„Ç¢„Éâ„Ç≠„É•„É°„É≥„Éà
              pipeline_doc += f'''

          ## ÁâπÂæ¥Èáè„Çπ„Éà„Ç¢

          ### FeatureStore „ÇØ„É©„Çπ

          {inspect.getdoc(FeatureStore) or '„Éâ„Ç≠„É•„É°„É≥„Éà„Å™„Åó'}

          #### ‰∏ªË¶Å„É°„ÇΩ„ÉÉ„Éâ
          '''

              for name, method in inspect.getmembers(FeatureStore, predicate=inspect.isfunction):
                  if not name.startswith('_'):
                      doc = inspect.getdoc(method) or '„Éâ„Ç≠„É•„É°„É≥„Éà„Å™„Åó'
                      signature = inspect.signature(method)
                      pipeline_doc += f'''

          ##### {name}{signature}

          {doc}
          '''

              with open('docs/ml/models.md', 'w', encoding='utf-8') as f:
                  f.write(pipeline_doc)

              print('Machine learning documentation generated')

          except Exception as e:
              print(f'Error generating ML docs: {e}')
          "

      - name: Generate database schema documentation
        run: |
          mkdir -p docs/database

          python -c "
          import sys
          import sqlite3
          import tempfile
          from datetime import datetime
          sys.path.insert(0, 'src')

          # „Éá„Éº„Çø„Éô„Éº„Çπ„Çπ„Ç≠„Éº„Éû„ÅÆÊñáÊõ∏Âåñ
          try:
              # „ÉÜ„Çπ„ÉàÁî®„ÅÆ„Éá„Éº„Çø„Éô„Éº„Çπ„Çí‰ΩúÊàê„Åó„Å¶„Çπ„Ç≠„Éº„Éû„ÇíÊäΩÂá∫
              with tempfile.NamedTemporaryFile(suffix='.db', delete=False) as tmp:
                  conn = sqlite3.connect(tmp.name)
                  cursor = conn.cursor()

                  # Êó¢Â≠ò„ÅÆ„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥„Åå„ÅÇ„Çå„Å∞ÂÆüË°å
                  try:
                      from day_trade.models.database import init_database
                      init_database(tmp.name)
                  except:
                      pass

                  # „ÉÜ„Éº„Éñ„É´‰∏ÄË¶ß„ÇíÂèñÂæó
                  cursor.execute(\"SELECT name FROM sqlite_master WHERE type='table'\")
                  tables = cursor.fetchall()

                  schema_doc = f'''
          # üóÑÔ∏è „Éá„Éº„Çø„Éô„Éº„Çπ„Çπ„Ç≠„Éº„Éû

          **ÁîüÊàêÊó•ÊôÇ**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
          **„Éá„Éº„Çø„Éô„Éº„Çπ**: SQLite

          ## „ÉÜ„Éº„Éñ„É´‰∏ÄË¶ß
          '''

                  for table in tables:
                      table_name = table[0]
                      if table_name == 'sqlite_sequence':
                          continue

                      schema_doc += f'''

          ### {table_name}

          '''

                      # „ÉÜ„Éº„Éñ„É´ÊßãÈÄ†„ÇíÂèñÂæó
                      cursor.execute(f'PRAGMA table_info({table_name})')
                      columns = cursor.fetchall()

                      if columns:
                          schema_doc += '''| „Ç´„É©„É†Âêç | Âûã | NULLË®±ÂèØ | „Éá„Éï„Ç©„É´„ÉàÂÄ§ | ‰∏ª„Ç≠„Éº |
          |----------|----|---------|--------------|---------|
          '''
                          for col in columns:
                              cid, name, type_, notnull, default, pk = col
                              null_ok = '‚ùå' if notnull else '‚úÖ'
                              is_pk = 'üîë' if pk else ''
                              default_val = default if default is not None else ''
                              schema_doc += f'| {name} | {type_} | {null_ok} | {default_val} | {is_pk} |\n'

                      # „Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÊÉÖÂ†±
                      cursor.execute(f\"SELECT name FROM sqlite_master WHERE type='index' AND tbl_name='{table_name}'\")
                      indexes = cursor.fetchall()
                      if indexes:
                          schema_doc += f'''

          **„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ**: {', '.join([idx[0] for idx in indexes if not idx[0].startswith('sqlite_')])}
          '''

                  conn.close()

                  with open('docs/database/schema.md', 'w', encoding='utf-8') as f:
                      f.write(schema_doc)

                  print('Database schema documentation generated')

          except Exception as e:
              print(f'Error generating database docs: {e}')
          "

      - name: Generate troubleshooting guide
        run: |
          mkdir -p docs/troubleshooting

          # „Çà„Åè„ÅÇ„ÇãÂïèÈ°å„Å®„Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç¨„Ç§„Éâ„ÇíÁîüÊàê
          cat > docs/troubleshooting/common-issues.md << 'EOF'
          # üîß „Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„Ç¨„Ç§„Éâ

          ## „Çà„Åè„ÅÇ„ÇãÂïèÈ°å„Å®Ëß£Ê±∫ÊñπÊ≥ï

          ### „Ç§„É≥„Çπ„Éà„Éº„É´Èñ¢ÈÄ£

          #### ÂïèÈ°å: ‰æùÂ≠òÈñ¢‰øÇ„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´„Å´Â§±Êïó„Åô„Çã

          **ÁóáÁä∂**:
          ```
          ERROR: Could not install packages due to an EnvironmentError
          ```

          **Ëß£Ê±∫ÊñπÊ≥ï**:
          ```bash
          # 1. pip „ÇíÊúÄÊñ∞Áâà„Å´„Ç¢„ÉÉ„Éó„Éá„Éº„Éà
          python -m pip install --upgrade pip

          # 2. „Ç∑„Çπ„ÉÜ„É†„É¨„Éô„É´„ÅÆ‰æùÂ≠òÈñ¢‰øÇ„Çí„Ç§„É≥„Çπ„Éà„Éº„É´ (Ubuntu/Debian)
          sudo apt-get update
          sudo apt-get install python3-dev build-essential

          # 3. ‰ªÆÊÉ≥Áí∞Â¢É„Çí‰ΩøÁî®
          python -m venv venv
          source venv/bin/activate  # Linux/Mac
          # „Åæ„Åü„ÅØ
          venv\Scripts\activate  # Windows
          pip install -r requirements.txt
          ```

          ### „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÈñ¢ÈÄ£

          #### ÂïèÈ°å: ÁâπÂæ¥ÈáèÁîüÊàê„ÅåÈÅÖ„ÅÑ

          **ÁóáÁä∂**: ÁâπÂæ¥ÈáèÁîüÊàê„Å´ÊÉ≥ÂÆö‰ª•‰∏ä„ÅÆÊôÇÈñì„Åå„Åã„Åã„Çã

          **Ëß£Ê±∫ÊñπÊ≥ï**:
          ```python
          # 1. „Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫„ÇíË™øÊï¥
          pipeline = FeaturePipeline()
          features = pipeline.batch_generate_features(data, batch_size=500)  # „Éá„Éï„Ç©„É´„Éà„Çà„ÇäÂ§ß„Åç„Åè

          # 2. „Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÊúâÂäπÂåñ
          from day_trade.ml.feature_store import FeatureStore
          store = FeatureStore(cache_size=1000)  # „Ç≠„É£„ÉÉ„Ç∑„É•„Çµ„Ç§„Ç∫„ÇíÂ¢ó„ÇÑ„Åô

          # 3. ‰∏¶ÂàóÂá¶ÁêÜ„ÅÆË®≠ÂÆöÁ¢∫Ë™ç
          import os
          os.environ['NUMBA_NUM_THREADS'] = '4'  # CPU „Ç≥„Ç¢Êï∞„Å´Âøú„Åò„Å¶Ë™øÊï¥
          ```

          #### ÂïèÈ°å: „É°„É¢„É™‰ΩøÁî®Èáè„ÅåÂ§ö„ÅÑ

          **ÁóáÁä∂**: „Ç∑„Çπ„ÉÜ„É†„Åå„É°„É¢„É™‰∏çË∂≥„Åß„ÇØ„É©„ÉÉ„Ç∑„É•„Åô„Çã

          **Ëß£Ê±∫ÊñπÊ≥ï**:
          ```python
          # 1. „Éê„ÉÉ„ÉÅ„Çµ„Ç§„Ç∫„ÇíÂ∞è„Åï„Åè„Åô„Çã
          features = pipeline.batch_generate_features(data, batch_size=100)

          # 2. ÊòéÁ§∫ÁöÑ„Å´„Ç¨„Éô„Éº„Ç∏„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„ÇíÂÆüË°å
          import gc
          gc.collect()

          # 3. „Éá„Éº„Çø„ÇíÂàÜÂâ≤„Åó„Å¶Âá¶ÁêÜ
          chunk_size = 1000
          for i in range(0, len(data), chunk_size):
              chunk = data[i:i+chunk_size]
              process_chunk(chunk)
          ```

          ### „Éá„Éº„Çø„Éô„Éº„ÇπÈñ¢ÈÄ£

          #### ÂïèÈ°å: „Éá„Éº„Çø„Éô„Éº„ÇπÊé•Á∂ö„Ç®„É©„Éº

          **ÁóáÁä∂**:
          ```
          sqlite3.OperationalError: database is locked
          ```

          **Ëß£Ê±∫ÊñπÊ≥ï**:
          ```python
          # 1. Êé•Á∂ö„Éó„Éº„É´„Çí‰ΩøÁî®
          from sqlalchemy import create_engine
          engine = create_engine('sqlite:///data/trading.db', pool_pre_ping=True)

          # 2. WAL„É¢„Éº„Éâ„ÇíÊúâÂäπÂåñ
          import sqlite3
          conn = sqlite3.connect('data/trading.db')
          conn.execute('PRAGMA journal_mode=WAL;')
          ```

          ### APIÈñ¢ÈÄ£

          #### ÂïèÈ°å: Â§ñÈÉ®API„Åã„Çâ„ÅÆ„Éá„Éº„ÇøÂèñÂæó„Å´Â§±Êïó„Åô„Çã

          **ÁóáÁä∂**: „É¨„Éº„ÉàÂà∂Èôê„ÇÑ„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Ç®„É©„Éº

          **Ëß£Ê±∫ÊñπÊ≥ï**:
          ```python
          # 1. „É™„Éà„É©„Ç§Ê©üËÉΩ„ÇíÂÆüË£Ö
          import time
          import requests
          from requests.adapters import HTTPAdapter
          from urllib3.util.retry import Retry

          session = requests.Session()
          retry_strategy = Retry(
              total=3,
              backoff_factor=1,
              status_forcelist=[429, 500, 502, 503, 504],
          )
          adapter = HTTPAdapter(max_retries=retry_strategy)
          session.mount("http://", adapter)
          session.mount("https://", adapter)

          # 2. „É¨„Éº„ÉàÂà∂Èôê„ÇíÂÆà„Çã
          time.sleep(0.1)  # „É™„ÇØ„Ç®„Çπ„ÉàÈñì„Å´ÈÅÖÂª∂„ÇíÂÖ•„Çå„Çã
          ```

          ## „É≠„Ç∞ÂàÜÊûê

          ### „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞„ÅÆÊúâÂäπÂåñ

          ```python
          import logging
          logging.basicConfig(level=logging.DEBUG)
          ```

          ### „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁõ£Ë¶ñ

          ```python
          import cProfile
          import pstats

          # „Éó„É≠„Éï„Ç°„Ç§„É™„É≥„Ç∞ÂÆüË°å
          cProfile.run('your_function()', 'profile_stats')

          # ÁµêÊûúÂàÜÊûê
          stats = pstats.Stats('profile_stats')
          stats.sort_stats('cumulative')
          stats.print_stats(10)  # ‰∏ä‰Ωç10‰ª∂Ë°®Á§∫
          ```

          ## „Çµ„Éù„Éº„ÉàÊÉÖÂ†±

          ÂïèÈ°å„ÅåËß£Ê±∫„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆÊÉÖÂ†±„Å®„Å®„ÇÇ„Å´„Ç§„Ç∑„É•„Éº„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö

          1. **Áí∞Â¢ÉÊÉÖÂ†±**:
             - OS: `uname -a` (Linux/Mac) „Åæ„Åü„ÅØ `systeminfo` (Windows)
             - Python „Éê„Éº„Ç∏„Éß„É≥: `python --version`
             - ‰æùÂ≠òÈñ¢‰øÇ: `pip freeze`

          2. **„Ç®„É©„Éº„É≠„Ç∞**:
             - ÂÆåÂÖ®„Å™„Çπ„Çø„ÉÉ„ÇØ„Éà„É¨„Éº„Çπ
             - Èñ¢ÈÄ£„Åô„Çã„É≠„Ç∞„Éï„Ç°„Ç§„É´

          3. **ÂÜçÁèæÊâãÈ†Ü**:
             - ÂïèÈ°å„ÇíÂÜçÁèæ„Åô„Çã„Åü„ÇÅ„ÅÆÊúÄÂ∞èÈôê„ÅÆ„Ç≥„Éº„Éâ
             - ‰ΩøÁî®„Åó„Åü„Éá„Éº„Çø„ÅÆ‰æã
          EOF

          echo "Troubleshooting guide generated"

      - name: Create documentation index
        run: |
          # „É°„Ç§„É≥„Éâ„Ç≠„É•„É°„É≥„Éà„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÅÆ‰ΩúÊàê
          cat > docs/index.md << 'EOF'
          # üìö Day Trade System Documentation

          Welcome to the comprehensive documentation for the Day Trade System!

          ## üóÇÔ∏è Documentation Sections

          ### ü§ñ [Machine Learning Models](ml/models.md)
          - Feature Pipeline documentation
          - Feature Store architecture
          - Model performance metrics

          ### üóÑÔ∏è [Database Schema](database/schema.md)
          - Table structures
          - Relationships and indexes
          - Migration history

          ### üîß [Troubleshooting Guide](troubleshooting/common-issues.md)
          - Common problems and solutions
          - Performance optimization tips
          - Debugging techniques

          ### üìñ [API Reference](api/)
          - Auto-generated API documentation
          - Code examples
          - Module references

          ## üöÄ Quick Start

          1. **Installation**:
             ```bash
             git clone https://github.com/kaenozu/day_trade.git
             cd day_trade
             pip install -r requirements.txt
             ```

          2. **Configuration**:
             ```bash
             cp config/settings.example.json config/settings.json
             # Edit settings.json with your configuration
             ```

          3. **Run**:
             ```bash
             python -m src.day_trade.main
             ```

          ## üìä Project Overview

          This system provides:
          - ‚ö° High-performance feature generation (77.6x speedup)
          - üîí Enterprise-grade security
          - üìà Real-time trading algorithms
          - ü§ñ Machine learning model pipeline
          - üìä Comprehensive monitoring and analytics

          ## üîÑ Continuous Updates

          This documentation is automatically updated on every code change.
          Last updated: $(date)

          ## üí¨ Support

          - [GitHub Issues](https://github.com/kaenozu/day_trade/issues)
          - [Troubleshooting Guide](troubleshooting/common-issues.md)
          EOF

      - name: Upload documentation artifacts
        uses: actions/upload-artifact@v4
        with:
          name: generated-documentation
          path: |
            docs/
            README.md

      - name: Commit documentation updates
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

          git add docs/ README.md

          if git diff --staged --quiet; then
            echo "No documentation changes to commit"
          else
            git commit -m "docs: automatic documentation update

            - Generated API documentation
            - Updated README statistics
            - Created ML model documentation
            - Generated database schema docs
            - Updated troubleshooting guide

            ü§ñ Generated with [Claude Code](https://claude.ai/code)

            Co-Authored-By: Claude <noreply@anthropic.com>"

            git push origin main
          fi

  deploy-docs:
    runs-on: ubuntu-latest
    needs: generate-api-docs
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4
        with:
          ref: main

      - name: Download documentation artifacts
        uses: actions/download-artifact@v4
        with:
          name: generated-documentation

      - name: Setup GitHub Pages
        uses: actions/configure-pages@v3

      - name: Build documentation site
        run: |
          mkdir -p _site
          cp -r docs/* _site/

          # „Ç∑„É≥„Éó„É´„Å™HTML„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„Çí‰ΩúÊàê
          cat > _site/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="ja">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Day Trade System Documentation</title>
              <style>
                  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 40px; }
                  .container { max-width: 800px; margin: 0 auto; }
                  h1 { color: #0366d6; }
                  .section { margin: 20px 0; padding: 20px; border: 1px solid #e1e4e8; border-radius: 6px; }
                  a { color: #0366d6; text-decoration: none; }
                  a:hover { text-decoration: underline; }
                  .emoji { font-size: 1.2em; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1><span class="emoji">üìö</span> Day Trade System Documentation</h1>

                  <div class="section">
                      <h2><span class="emoji">ü§ñ</span> Machine Learning</h2>
                      <p><a href="ml/models.md">Feature Pipeline & Model Documentation</a></p>
                  </div>

                  <div class="section">
                      <h2><span class="emoji">üóÑÔ∏è</span> Database</h2>
                      <p><a href="database/schema.md">Schema Documentation</a></p>
                  </div>

                  <div class="section">
                      <h2><span class="emoji">üîß</span> Troubleshooting</h2>
                      <p><a href="troubleshooting/common-issues.md">Common Issues & Solutions</a></p>
                  </div>

                  <div class="section">
                      <h2><span class="emoji">üìñ</span> API Reference</h2>
                      <p><a href="sphinx/build/html/index.html">Auto-generated API Docs</a></p>
                  </div>

                  <footer style="margin-top: 40px; text-align: center; color: #586069;">
                      <p>Documentation automatically generated by GitHub Actions</p>
                      <p>Last updated: $(date)</p>
                  </footer>
              </div>
          </body>
          </html>
          EOF

      - name: Upload to GitHub Pages
        uses: actions/upload-pages-artifact@v2
        with:
          path: _site

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2
