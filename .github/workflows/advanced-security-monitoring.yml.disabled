name: Advanced Security Monitoring & Response

on:
  schedule:
    - cron: '0 */6 * * *'  # 6æ™‚é–“æ¯ã®é«˜é »åº¦ç›£è¦–
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:
    inputs:
      scan_depth:
        description: 'Security scan depth'
        required: false
        default: 'comprehensive'
        type: choice
        options:
        - basic
        - standard
        - comprehensive
        - enterprise
      emergency_scan:
        description: 'Emergency security scan (high priority)'
        required: false
        default: false
        type: boolean

permissions:
  contents: read
  security-events: write
  issues: write
  pull-requests: write
  actions: read

jobs:
  threat-intelligence:
    runs-on: ubuntu-latest
    outputs:
      threat-level: ${{ steps.threat-assessment.outputs.threat-level }}
      active-threats: ${{ steps.threat-assessment.outputs.active-threats }}
    steps:
      - uses: actions/checkout@v4

      - name: ğŸ•µï¸ Threat Intelligence Gathering
        id: threat-assessment
        run: |
          echo "ğŸ•µï¸ è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹åé›†é–‹å§‹..."

          # ç¾åœ¨ã®è„…å¨ãƒ¬ãƒ™ãƒ«è©•ä¾¡
          THREAT_LEVEL="normal"
          ACTIVE_THREATS=0

          # æœ€è¿‘ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒªãƒã‚§ãƒƒã‚¯
          echo "### ğŸš¨ è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹è©•ä¾¡" > threat_intel.md
          echo "" >> threat_intel.md

          # GitHub Security Advisories API ã‚’ä½¿ç”¨ã—ã¦æœ€æ–°ã®è„…å¨æƒ…å ±ã‚’å–å¾—
          curl -s -H "Accept: application/vnd.github+json" \
            "https://api.github.com/advisories?per_page=10&sort=published&direction=desc" \
            > advisories.json

          # Pythonç”Ÿæ…‹ç³»ã®æœ€è¿‘ã®è„†å¼±æ€§ã‚’ç¢ºèª
          PYTHON_ADVISORIES=$(jq -r '.[] | select(.ecosystem == "pip" or .ecosystem == "PyPI") | .id' advisories.json | head -3)

          if [ ! -z "$PYTHON_ADVISORIES" ]; then
            echo "âš ï¸ **æœ€è¿‘ã®Pythonè„†å¼±æ€§ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒª**:" >> threat_intel.md
            for advisory in $PYTHON_ADVISORIES; do
              ADVISORY_INFO=$(jq -r ".[] | select(.id == \"$advisory\") | \"\(.summary) (Severity: \(.severity // \"Unknown\"))\"" advisories.json)
              echo "- $advisory: $ADVISORY_INFO" >> threat_intel.md
              ACTIVE_THREATS=$((ACTIVE_THREATS + 1))
            done
            THREAT_LEVEL="elevated"
          else
            echo "âœ… **æœ€è¿‘ã®é‡å¤§ãªè„…å¨**: ãªã—" >> threat_intel.md
          fi

          echo "" >> threat_intel.md

          # å†…éƒ¨è„…å¨æŒ‡æ¨™ã®è©•ä¾¡
          echo "#### å†…éƒ¨è„…å¨æŒ‡æ¨™" >> threat_intel.md

          # ç•°å¸¸ãªä¾å­˜é–¢ä¿‚ã®å¤‰æ›´ã‚’ãƒã‚§ãƒƒã‚¯
          if git log --since="24 hours ago" --name-only | grep -E "(requirements|pyproject|setup)" > dependency_changes.txt && [ -s dependency_changes.txt ]; then
            echo "ğŸ” **æœ€è¿‘ã®ä¾å­˜é–¢ä¿‚å¤‰æ›´**:" >> threat_intel.md
            cat dependency_changes.txt >> threat_intel.md
            THREAT_LEVEL="elevated"
          else
            echo "âœ… **ä¾å­˜é–¢ä¿‚**: å¤‰æ›´ãªã—" >> threat_intel.md
          fi

          echo "" >> threat_intel.md
          echo "**è„…å¨ãƒ¬ãƒ™ãƒ«**: $THREAT_LEVEL" >> threat_intel.md
          echo "**ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è„…å¨æ•°**: $ACTIVE_THREATS" >> threat_intel.md

          echo "threat-level=$THREAT_LEVEL" >> $GITHUB_OUTPUT
          echo "active-threats=$ACTIVE_THREATS" >> $GITHUB_OUTPUT

      - name: Upload threat intelligence
        uses: actions/upload-artifact@v4
        with:
          name: threat-intelligence-${{ github.sha }}
          path: threat_intel.md

  real-time-monitoring:
    runs-on: ubuntu-latest
    needs: threat-intelligence
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'

      - name: ğŸ”„ Real-time Security Monitoring
        run: |
          echo "ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–é–‹å§‹..."

          # é«˜é »åº¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ
          python -m pip install --upgrade pip
          pip install safety bandit semgrep pip-audit trivy-operator httpx aiofiles psutil
          pip install -e ".[dev,test]"

          echo "## ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆ" > realtime_security.md
          echo "" >> realtime_security.md
          echo "**ç›£è¦–æ™‚åˆ»**: $(date -u)" >> realtime_security.md
          echo "**è„…å¨ãƒ¬ãƒ™ãƒ«**: ${{ needs.threat-intelligence.outputs.threat-level }}" >> realtime_security.md
          echo "" >> realtime_security.md

      - name: ğŸš€ Accelerated Vulnerability Scanning
        run: |
          echo "### âš¡ é«˜é€Ÿè„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³" >> realtime_security.md
          echo "" >> realtime_security.md

          # ä¸¦åˆ—å®Ÿè¡Œã§é«˜é€ŸåŒ–
          {
            # Safety check (ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰)
            safety check --json > safety_realtime.json 2>/dev/null &
            SAFETY_PID=$!

            # Bandit (ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰)
            bandit -r src/ -f json -o bandit_realtime.json -ll 2>/dev/null &
            BANDIT_PID=$!

            # pip-audit (ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰)
            pip-audit --format=json --output=audit_realtime.json 2>/dev/null &
            AUDIT_PID=$!

            # ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹å®Œäº†ã‚’å¾…æ©Ÿ
            wait $SAFETY_PID
            SAFETY_RESULT=$?
            wait $BANDIT_PID
            BANDIT_RESULT=$?
            wait $AUDIT_PID
            AUDIT_RESULT=$?

            # çµæœé›†è¨ˆ
            echo "#### ã‚¹ã‚­ãƒ£ãƒ³çµæœ (ä¸¦åˆ—å®Ÿè¡Œ)" >> realtime_security.md
            echo "- Safety: $([ $SAFETY_RESULT -eq 0 ] && echo 'âœ… OK' || echo 'âŒ Issues')" >> realtime_security.md
            echo "- Bandit: $([ $BANDIT_RESULT -eq 0 ] && echo 'âœ… OK' || echo 'âŒ Issues')" >> realtime_security.md
            echo "- pip-audit: $([ $AUDIT_RESULT -eq 0 ] && echo 'âœ… OK' || echo 'âŒ Issues')" >> realtime_security.md
            echo "" >> realtime_security.md
          }

      - name: ğŸ§  AI-Powered Security Analysis
        run: |
          echo "### ğŸ§  AIé§†å‹•ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ†æ" >> realtime_security.md
          echo "" >> realtime_security.md

          # ã‚«ã‚¹ã‚¿ãƒ AIåˆ†æã‚·ã‚¹ãƒ†ãƒ 
          python -c "
import json
import os
import re
from pathlib import Path
import hashlib

class AISecurityAnalyzer:
    def __init__(self):
        self.security_patterns = {
            'high_risk': [
                r'exec\s*\(',
                r'eval\s*\(',
                r'os\.system\s*\(',
                r'subprocess\..*shell\s*=\s*True',
                r'pickle\.loads?\s*\(',
                r'yaml\.load\s*\(',
                r'__import__\s*\(',
            ],
            'crypto_issues': [
                r'hashlib\.md5\s*\(',
                r'hashlib\.sha1\s*\(',
                r'random\.random\s*\(',
                r'urllib\.request\.urlopen\s*\(',
            ],
            'injection_vectors': [
                r'\.format\s*\([^)]*\%',
                r'f[\"\']\{.*\}[\"\']\%',
                r'sql.*\%.*\%',
                r'query.*\+.*\+',
            ]
        }

    def analyze_codebase(self):
        results = {
            'high_risk_patterns': 0,
            'crypto_issues': 0,
            'injection_vectors': 0,
            'files_analyzed': 0,
            'security_score': 100,
            'findings': []
        }

        src_path = Path('src')
        if src_path.exists():
            for py_file in src_path.rglob('*.py'):
                results['files_analyzed'] += 1
                try:
                    content = py_file.read_text(encoding='utf-8')

                    for category, patterns in self.security_patterns.items():
                        for pattern in patterns:
                            matches = re.finditer(pattern, content, re.IGNORECASE)
                            for match in matches:
                                line_num = content[:match.start()].count('\n') + 1
                                results[category] += 1
                                results['security_score'] -= 5  # å„å•é¡Œã§5ç‚¹æ¸›ç‚¹

                                results['findings'].append({
                                    'file': str(py_file),
                                    'line': line_num,
                                    'pattern': pattern,
                                    'category': category,
                                    'match': match.group()[:100]
                                })
                except Exception as e:
                    continue

        results['security_score'] = max(0, results['security_score'])
        return results

    def generate_recommendations(self, results):
        recommendations = []

        if results['high_risk_patterns'] > 0:
            recommendations.append('ğŸš¨ é«˜ãƒªã‚¹ã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚exec/evalã®ä½¿ç”¨ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚')

        if results['crypto_issues'] > 0:
            recommendations.append('ğŸ”’ å¼±ã„æš—å·åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚SHA-256ä»¥ä¸Šã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚')

        if results['injection_vectors'] > 0:
            recommendations.append('ğŸ’‰ æ½œåœ¨çš„ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³è„†å¼±æ€§ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚')

        if results['security_score'] >= 90:
            recommendations.append('âœ… å„ªç§€ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ã§ã™ã€‚ç¾çŠ¶ã‚’ç¶­æŒã—ã¦ãã ã•ã„ã€‚')
        elif results['security_score'] >= 70:
            recommendations.append('âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ã¯è‰¯å¥½ã§ã™ãŒã€æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚')
        else:
            recommendations.append('ğŸš¨ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ãŒä½ã„ã§ã™ã€‚é‡è¦ãªå•é¡Œã¸ã®å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚')

        return recommendations

# AIåˆ†æå®Ÿè¡Œ
analyzer = AISecurityAnalyzer()
analysis = analyzer.analyze_codebase()
recommendations = analyzer.generate_recommendations(analysis)

# çµæœå‡ºåŠ›
print(f'**åˆ†æãƒ•ã‚¡ã‚¤ãƒ«æ•°**: {analysis[\"files_analyzed\"]}')
print(f'**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢**: {analysis[\"security_score\"]}/100')
print('')

if analysis['findings']:
    print('#### æ¤œå‡ºã•ã‚ŒãŸæ½œåœ¨çš„å•é¡Œ')
    for finding in analysis['findings'][:5]:  # ä¸Šä½5ä»¶
        print(f'- **{finding[\"category\"]}**: {finding[\"file\"]}:{finding[\"line\"]} - {finding[\"match\"]}')
    print('')

print('#### AIæ¨å¥¨äº‹é …')
for rec in recommendations:
    print(f'- {rec}')
" >> realtime_security.md

      - name: ğŸ“Š Advanced Metrics Collection
        run: |
          echo "" >> realtime_security.md
          echo "### ğŸ“Š è©³ç´°ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¡ãƒˆãƒªã‚¯ã‚¹" >> realtime_security.md
          echo "" >> realtime_security.md

          # ã‚·ã‚¹ãƒ†ãƒ æŒ‡æ¨™ã®åé›†
          python -c "
import psutil
import os
import time
from datetime import datetime

# ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±åé›†
def collect_system_metrics():
    metrics = {
        'cpu_percent': psutil.cpu_percent(interval=1),
        'memory_percent': psutil.virtual_memory().percent,
        'disk_percent': psutil.disk_usage('/').percent,
        'network_io': psutil.net_io_counters()._asdict(),
        'process_count': len(psutil.pids()),
        'timestamp': datetime.utcnow().isoformat()
    }
    return metrics

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
def check_file_integrity():
    critical_files = [
        'pyproject.toml',
        'src/day_trade/__init__.py',
        '.github/workflows/security-scan.yml'
    ]

    integrity_report = []
    for file_path in critical_files:
        if os.path.exists(file_path):
            stat = os.stat(file_path)
            integrity_report.append({
                'file': file_path,
                'size': stat.st_size,
                'modified': datetime.fromtimestamp(stat.st_mtime).isoformat(),
                'status': 'ok'
            })
        else:
            integrity_report.append({
                'file': file_path,
                'status': 'missing'
            })

    return integrity_report

# ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†å®Ÿè¡Œ
metrics = collect_system_metrics()
integrity = check_file_integrity()

print('#### ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹')
print(f'- **CPUä½¿ç”¨ç‡**: {metrics[\"cpu_percent\"]:.1f}%')
print(f'- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡**: {metrics[\"memory_percent\"]:.1f}%')
print(f'- **ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡**: {metrics[\"disk_percent\"]:.1f}%')
print(f'- **ãƒ—ãƒ­ã‚»ã‚¹æ•°**: {metrics[\"process_count\"]}')
print('')

print('#### ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯')
missing_files = [f for f in integrity if f['status'] == 'missing']
if missing_files:
    print('âš ï¸ **æ¬ æãƒ•ã‚¡ã‚¤ãƒ«**:')
    for f in missing_files:
        print(f'  - {f[\"file\"]}')
else:
    print('âœ… **é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«**: å…¨ã¦å­˜åœ¨')

print('')
print(f'**åé›†æ™‚åˆ»**: {metrics[\"timestamp\"]}')
" >> realtime_security.md

      - name: ğŸ”¬ Zero-Day Detection System
        if: needs.threat-intelligence.outputs.threat-level == 'elevated' || github.event.inputs.emergency_scan == 'true'
        run: |
          echo "" >> realtime_security.md
          echo "### ğŸ”¬ ã‚¼ãƒ­ãƒ‡ã‚¤è„…å¨æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ " >> realtime_security.md
          echo "" >> realtime_security.md
          echo "**ãƒˆãƒªã‚¬ãƒ¼**: è„…å¨ãƒ¬ãƒ™ãƒ«ä¸Šæ˜‡ã¾ãŸã¯ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ç·Šæ€¥ã‚¹ã‚­ãƒ£ãƒ³" >> realtime_security.md
          echo "" >> realtime_security.md

          # é«˜åº¦ãªãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ã«ã‚ˆã‚‹ã‚¼ãƒ­ãƒ‡ã‚¤æ¤œå‡º
          python -c "
import re
import os
from pathlib import Path

class ZeroDayDetector:
    def __init__(self):
        # æ—¢çŸ¥ã®ã‚¼ãƒ­ãƒ‡ã‚¤æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³
        self.zero_day_patterns = [
            # ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
            r'\\\\x[0-9a-fA-F]{2}.*\\\\x[0-9a-fA-F]{2}',
            # ç•°å¸¸ãªæ–‡å­—åˆ—é€£çµ
            r'chr\s*\(\s*\d+\s*\)\s*\+\s*chr\s*\(\s*\d+\s*\)',
            # Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç–‘ã‚ã—ã„æ–‡å­—åˆ—
            r'[A-Za-z0-9+/]{40,}={0,2}',
            # ç–‘ã‚ã—ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é€šä¿¡
            r'socket\.(AF_INET|SOCK_STREAM).*connect',
            # æš—å·åŒ–ã•ã‚ŒãŸæ–‡å­—åˆ—ã®å‹•çš„å¾©å·åŒ–
            r'decrypt\s*\(.*encode\s*\(',
        ]

    def scan_for_zero_days(self):
        findings = []
        src_path = Path('src')

        if src_path.exists():
            for py_file in src_path.rglob('*.py'):
                try:
                    content = py_file.read_text(encoding='utf-8')

                    for pattern in self.zero_day_patterns:
                        matches = re.finditer(pattern, content, re.IGNORECASE)
                        for match in matches:
                            line_num = content[:match.start()].count('\\n') + 1
                            findings.append({
                                'file': str(py_file),
                                'line': line_num,
                                'pattern': pattern,
                                'match': match.group()[:100],
                                'confidence': self._calculate_confidence(match.group(), pattern)
                            })
                except Exception:
                    continue

        return findings

    def _calculate_confidence(self, match, pattern):
        # åŸºæœ¬çš„ãªä¿¡é ¼åº¦è¨ˆç®—
        score = 50  # ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢

        # é•·ã„ä¸€è‡´ã»ã©ä¿¡é ¼åº¦ãŒé«˜ã„
        if len(match) > 50:
            score += 20
        elif len(match) > 20:
            score += 10

        # ç‰¹å®šãƒ‘ã‚¿ãƒ¼ãƒ³ã®é‡ã¿ä»˜ã‘
        if 'socket' in pattern:
            score += 15
        elif 'decrypt' in pattern:
            score += 25
        elif 'chr' in pattern:
            score += 10

        return min(100, score)

# ã‚¼ãƒ­ãƒ‡ã‚¤æ¤œå‡ºå®Ÿè¡Œ
detector = ZeroDayDetector()
zero_day_findings = detector.scan_for_zero_days()

if zero_day_findings:
    print('ğŸš¨ **æ½œåœ¨çš„ã‚¼ãƒ­ãƒ‡ã‚¤è„…å¨æ¤œå‡º**:')
    high_confidence = [f for f in zero_day_findings if f['confidence'] >= 70]

    if high_confidence:
        print('')
        print('#### é«˜ä¿¡é ¼åº¦ã®è„…å¨:')
        for finding in high_confidence:
            print(f'- **{finding[\"file\"]}:{finding[\"line\"]}** (ä¿¡é ¼åº¦: {finding[\"confidence\"]}%)')
            print(f'  ãƒ‘ã‚¿ãƒ¼ãƒ³: {finding[\"match\"]}')
        print('')
        print('ğŸš¨ **å³åº§ã®èª¿æŸ»ãŒå¿…è¦ã§ã™**')
    else:
        print('âš ï¸ ä½ä¿¡é ¼åº¦ã®æ¤œå‡ºã®ã¿ã€‚ç¶™ç¶šç›£è¦–ä¸­...')
else:
    print('âœ… **ã‚¼ãƒ­ãƒ‡ã‚¤è„…å¨**: æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ')
" >> realtime_security.md

      - name: ğŸ“¤ Upload real-time monitoring results
        uses: actions/upload-artifact@v4
        with:
          name: realtime-security-monitoring-${{ github.sha }}
          path: |
            realtime_security.md
            *_realtime.json

  incident-response:
    runs-on: ubuntu-latest
    needs: [threat-intelligence, real-time-monitoring]
    if: needs.threat-intelligence.outputs.threat-level == 'elevated' || failure()
    steps:
      - uses: actions/checkout@v4

      - name: ğŸš¨ Security Incident Response
        run: |
          echo "ğŸš¨ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œé–‹å§‹..."

          echo "# ğŸš¨ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œãƒ¬ãƒãƒ¼ãƒˆ" > incident_response.md
          echo "" >> incident_response.md
          echo "**ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆæ¤œå‡ºæ™‚åˆ»**: $(date -u)" >> incident_response.md
          echo "**è„…å¨ãƒ¬ãƒ™ãƒ«**: ${{ needs.threat-intelligence.outputs.threat-level }}" >> incident_response.md
          echo "**ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è„…å¨æ•°**: ${{ needs.threat-intelligence.outputs.active-threats }}" >> incident_response.md
          echo "" >> incident_response.md

          echo "## ğŸ“‹ åˆæœŸå¯¾å¿œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ" >> incident_response.md
          echo "" >> incident_response.md
          echo "- [ ] è„…å¨ãƒ¬ãƒ™ãƒ«ã®ç¢ºèªã¨åˆ†æ" >> incident_response.md
          echo "- [ ] å½±éŸ¿ç¯„å›²ã®ç‰¹å®š" >> incident_response.md
          echo "- [ ] ç·Šæ€¥ãƒ‘ãƒƒãƒã®å¿…è¦æ€§è©•ä¾¡" >> incident_response.md
          echo "- [ ] ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã¸ã®é€šçŸ¥" >> incident_response.md
          echo "- [ ] å¾©æ—§è¨ˆç”»ã®ç­–å®š" >> incident_response.md
          echo "" >> incident_response.md

          echo "## ğŸ” æ¨å¥¨ã•ã‚Œã‚‹å³åº§ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³" >> incident_response.md
          echo "" >> incident_response.md

          if [ "${{ needs.threat-intelligence.outputs.threat-level }}" == "elevated" ]; then
            echo "1. **ç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã®å¼·åŒ–**" >> incident_response.md
            echo "   - ç›£è¦–é »åº¦ã‚’1æ™‚é–“æ¯ã«å¢—åŠ " >> incident_response.md
            echo "   - å…¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹å®Œå…¨ã‚¹ã‚­ãƒ£ãƒ³å®Ÿè¡Œ" >> incident_response.md
            echo "" >> incident_response.md

            echo "2. **ä¾å­˜é–¢ä¿‚ã®ç·Šæ€¥æ›´æ–°**" >> incident_response.md
            echo "   - è„†å¼±æ€§ã®ã‚ã‚‹ä¾å­˜é–¢ä¿‚ã®å³åº§ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ" >> incident_response.md
            echo "   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã®é©ç”¨ç¢ºèª" >> incident_response.md
            echo "" >> incident_response.md

            echo "3. **ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å¼·åŒ–**" >> incident_response.md
            echo "   - é‡è¦ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ç›£è¦–å¼·åŒ–" >> incident_response.md
            echo "   - ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º" >> incident_response.md
          fi

          echo "" >> incident_response.md
          echo "## ğŸ“ ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é€£çµ¡å…ˆ" >> incident_response.md
          echo "" >> incident_response.md
          echo "- **ãƒ—ãƒ©ã‚¤ãƒãƒª**: @kaenozu" >> incident_response.md
          echo "- **ã‚»ã‚«ãƒ³ãƒ€ãƒª**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒ¼ãƒ " >> incident_response.md
          echo "- **ç·Šæ€¥æ™‚**: Issue #419 é–¢é€£ã‚¿ã‚¹ã‚¯ãƒ•ã‚©ãƒ¼ã‚¹" >> incident_response.md

      - name: Create emergency security issue
        if: needs.threat-intelligence.outputs.threat-level == 'elevated'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');

            try {
              const incident_report = fs.readFileSync('incident_response.md', 'utf8');

              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `ğŸš¨ ç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ - è„…å¨ãƒ¬ãƒ™ãƒ«ä¸Šæ˜‡ - ${new Date().toISOString().split('T')[0]}`,
                body: incident_report,
                labels: ['security', 'critical', 'incident-response', 'automated'],
                assignees: ['kaenozu']
              });

              console.log('ç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¾ã—ãŸ');
            } catch (error) {
              console.error('ç·Šæ€¥ã‚¤ã‚·ãƒ¥ãƒ¼ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
            }

      - name: Upload incident response
        uses: actions/upload-artifact@v4
        with:
          name: security-incident-response-${{ github.sha }}
          path: incident_response.md

  compliance-audit:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule' || github.event.inputs.scan_depth == 'enterprise'
    steps:
      - uses: actions/checkout@v4

      - name: ğŸ“‹ Enterprise Compliance Audit
        run: |
          echo "ğŸ“‹ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç›£æŸ»é–‹å§‹..."

          echo "# ğŸ“‹ Enterprise Security Compliance Audit" > compliance_audit.md
          echo "" >> compliance_audit.md
          echo "**ç›£æŸ»å®Ÿè¡Œæ—¥æ™‚**: $(date -u)" >> compliance_audit.md
          echo "**ç›£æŸ»åŸºæº–**: NIST CSF, ISO27001, SOC2, PCI-DSS" >> compliance_audit.md
          echo "" >> compliance_audit.md

      - name: ğŸ›ï¸ Regulatory Compliance Check
        run: |
          echo "## ğŸ›ï¸ è¦åˆ¶ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çŠ¶æ³" >> compliance_audit.md
          echo "" >> compliance_audit.md

          # NIST Cybersecurity Framework ãƒã‚§ãƒƒã‚¯
          echo "### NIST Cybersecurity Framework æº–æ‹ åº¦" >> compliance_audit.md
          echo "" >> compliance_audit.md

          NIST_CHECKLIST=(
            "IDENTIFY:è³‡ç”£ç®¡ç†ã¨ãƒªã‚¹ã‚¯è©•ä¾¡"
            "PROTECT:ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã¨ãƒ‡ãƒ¼ã‚¿ä¿è­·"
            "DETECT:ç•°å¸¸æ¤œçŸ¥ã¨ç›£è¦–"
            "RESPOND:ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œè¨ˆç”»"
            "RECOVER:å¾©æ—§ãƒ—ãƒ­ã‚»ã‚¹ã¨äº‹æ¥­ç¶™ç¶š"
          )

          for item in "${NIST_CHECKLIST[@]}"; do
            category=$(echo $item | cut -d: -f1)
            description=$(echo $item | cut -d: -f2)

            # åŸºæœ¬çš„ãªå®Ÿè£…ãƒã‚§ãƒƒã‚¯ (å®Ÿéš›ã®ç’°å¢ƒã§ã¯è©³ç´°ãªæ¤œè¨¼ãŒå¿…è¦)
            if [ -d "src/day_trade/security" ] && [ -f ".github/workflows/security-scan.yml" ]; then
              echo "- âœ… **$category**: $description - å®Ÿè£…æ¸ˆã¿" >> compliance_audit.md
            else
              echo "- âŒ **$category**: $description - è¦å®Ÿè£…" >> compliance_audit.md
            fi
          done

          echo "" >> compliance_audit.md

      - name: ğŸ”’ Data Protection Compliance (GDPR/CCPA)
        run: |
          echo "### ğŸ”’ ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦åˆ¶ (GDPR/CCPA) æº–æ‹ " >> compliance_audit.md
          echo "" >> compliance_audit.md

          # ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦ä»¶ã®ç¢ºèª
          DATA_PROTECTION_CHECKS=(
            "å€‹äººãƒ‡ãƒ¼ã‚¿ã®æš—å·åŒ–"
            "ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“ã®ç®¡ç†"
            "ãƒ‡ãƒ¼ã‚¿å‰Šé™¤æ¨©ã®å®Ÿè£…"
            "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒã‚¤ãƒ‡ã‚¶ã‚¤ãƒ³"
            "ãƒ‡ãƒ¼ã‚¿ä¾µå®³é€šçŸ¥ãƒ—ãƒ­ã‚»ã‚¹"
          )

          for check in "${DATA_PROTECTION_CHECKS[@]}"; do
            # å®Ÿè£…çŠ¶æ³ã®ç¢ºèª (ç°¡ç•¥ç‰ˆ)
            if grep -r -i "encrypt\|privacy\|gdpr\|personal.*data" src/ >/dev/null 2>&1; then
              echo "- ğŸŸ¡ **$check**: éƒ¨åˆ†çš„å®Ÿè£… - ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¨å¥¨" >> compliance_audit.md
            else
              echo "- âš ï¸ **$check**: æœªç¢ºèª - è©³ç´°èª¿æŸ»ãŒå¿…è¦" >> compliance_audit.md
            fi
          done

          echo "" >> compliance_audit.md

      - name: ğŸ’° Financial Services Compliance
        run: |
          echo "### ğŸ’° é‡‘èã‚µãƒ¼ãƒ“ã‚¹è¦åˆ¶æº–æ‹ " >> compliance_audit.md
          echo "" >> compliance_audit.md

          # é‡‘èè¦åˆ¶è¦ä»¶ (SOX, PCI-DSSç­‰)
          FINANCIAL_COMPLIANCE=(
            "SOX_404:å†…éƒ¨çµ±åˆ¶å ±å‘Š"
            "PCI_DSS:æ±ºæ¸ˆã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ä¿è­·"
            "FFIEC:é‡‘èæ©Ÿé–¢ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£"
            "FINRA:è¨¼åˆ¸æ¥­è¦åˆ¶"
            "BASEL_III:ãƒªã‚¹ã‚¯ç®¡ç†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯"
          )

          echo "#### é‡‘èæ¥­ç•Œè¦åˆ¶æº–æ‹ çŠ¶æ³:" >> compliance_audit.md
          echo "" >> compliance_audit.md

          for regulation in "${FINANCIAL_COMPLIANCE[@]}"; do
            code=$(echo $regulation | cut -d: -f1)
            description=$(echo $regulation | cut -d: -f2)

            # åŸºæœ¬ãƒã‚§ãƒƒã‚¯ (å®Ÿéš›ã®ç›£æŸ»ã§ã¯å°‚é–€çš„ãªè©•ä¾¡ãŒå¿…è¦)
            echo "- ğŸ“Š **$code**: $description" >> compliance_audit.md
            echo "  - ç›£æŸ»ãƒ­ã‚°: $([ -f 'src/day_trade/security/audit_log.py' ] && echo 'å®Ÿè£…æ¸ˆã¿' || echo 'è¦ç¢ºèª')" >> compliance_audit.md
            echo "  - ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–: $(grep -r 'encrypt\|cipher' src/ >/dev/null 2>&1 && echo 'å®Ÿè£…æ¸ˆã¿' || echo 'è¦ç¢ºèª')" >> compliance_audit.md
            echo "  - ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡: $([ -f 'src/day_trade/security/access_control.py' ] && echo 'å®Ÿè£…æ¸ˆã¿' || echo 'è¦ç¢ºèª')" >> compliance_audit.md
            echo "" >> compliance_audit.md
          done

      - name: ğŸ“Š Compliance Score Calculation
        run: |
          echo "## ğŸ“Š ç·åˆã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚¹ã‚³ã‚¢" >> compliance_audit.md
          echo "" >> compliance_audit.md

          # ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚¹ã‚³ã‚¢è¨ˆç®— (ç°¡ç•¥ç‰ˆ)
          IMPLEMENTED_CONTROLS=0
          TOTAL_CONTROLS=20

          # å®Ÿè£…æ¸ˆã¿åˆ¶å¾¡ã®æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
          if [ -d "src/day_trade/security" ]; then IMPLEMENTED_CONTROLS=$((IMPLEMENTED_CONTROLS + 5)); fi
          if [ -f ".github/workflows/security-scan.yml" ]; then IMPLEMENTED_CONTROLS=$((IMPLEMENTED_CONTROLS + 3)); fi
          if grep -r "encrypt" src/ >/dev/null 2>&1; then IMPLEMENTED_CONTROLS=$((IMPLEMENTED_CONTROLS + 4)); fi
          if grep -r "audit\|log" src/ >/dev/null 2>&1; then IMPLEMENTED_CONTROLS=$((IMPLEMENTED_CONTROLS + 3)); fi
          if [ -f "src/day_trade/security/access_control.py" ]; then IMPLEMENTED_CONTROLS=$((IMPLEMENTED_CONTROLS + 5)); fi

          COMPLIANCE_PERCENTAGE=$((IMPLEMENTED_CONTROLS * 100 / TOTAL_CONTROLS))

          echo "**å®Ÿè£…æ¸ˆã¿åˆ¶å¾¡**: $IMPLEMENTED_CONTROLS / $TOTAL_CONTROLS" >> compliance_audit.md
          echo "**ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚¹ã‚³ã‚¢**: $COMPLIANCE_PERCENTAGE%" >> compliance_audit.md
          echo "" >> compliance_audit.md

          if [ $COMPLIANCE_PERCENTAGE -ge 80 ]; then
            echo "ğŸŸ¢ **è©•ä¾¡**: å„ªç§€ - é«˜ã„ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹æ°´æº–" >> compliance_audit.md
          elif [ $COMPLIANCE_PERCENTAGE -ge 60 ]; then
            echo "ğŸŸ¡ **è©•ä¾¡**: è‰¯å¥½ - æ”¹å–„ã®ä½™åœ°ã‚ã‚Š" >> compliance_audit.md
          else
            echo "ğŸ”´ **è©•ä¾¡**: è¦æ”¹å–„ - é‡è¦ãªåˆ¶å¾¡ãŒä¸è¶³" >> compliance_audit.md
          fi

          echo "" >> compliance_audit.md
          echo "## ğŸš€ æ”¹å–„æ¨å¥¨äº‹é …" >> compliance_audit.md
          echo "" >> compliance_audit.md

          if [ $COMPLIANCE_PERCENTAGE -lt 100 ]; then
            echo "- ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ã®å®Œå…¨å®Ÿè£…" >> compliance_audit.md
            echo "- åŒ…æ‹¬çš„ç›£æŸ»ãƒ­ã‚°æ©Ÿèƒ½ã®å¼·åŒ–" >> compliance_audit.md
            echo "- å®šæœŸçš„ãªãƒªã‚¹ã‚¯è©•ä¾¡ã®å®Ÿæ–½" >> compliance_audit.md
            echo "- å¾“æ¥­å“¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ•™è‚²ã®ç¶™ç¶š" >> compliance_audit.md
          fi

      - name: Upload compliance audit
        uses: actions/upload-artifact@v4
        with:
          name: compliance-audit-${{ github.sha }}
          path: compliance_audit.md

  comprehensive-dashboard:
    runs-on: ubuntu-latest
    needs: [threat-intelligence, real-time-monitoring, compliance-audit]
    if: always()
    steps:
      - name: Download all security reports
        uses: actions/download-artifact@v4

      - name: ğŸ“Š Generate Comprehensive Security Dashboard
        run: |
          echo "ğŸ“Š åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”Ÿæˆä¸­..."

          echo "# ğŸ” Advanced Security Monitoring Dashboard" > security_dashboard.md
          echo "" >> security_dashboard.md
          echo "**ç”Ÿæˆæ—¥æ™‚**: $(date -u)" >> security_dashboard.md
          echo "**ãƒªãƒã‚¸ãƒˆãƒª**: ${{ github.repository }}" >> security_dashboard.md
          echo "**ã‚³ãƒŸãƒƒãƒˆ**: ${{ github.sha }}" >> security_dashboard.md
          echo "**ãƒ–ãƒ©ãƒ³ãƒ**: ${{ github.ref }}" >> security_dashboard.md
          echo "" >> security_dashboard.md

          echo "## ğŸ“ˆ Executive Summary" >> security_dashboard.md
          echo "" >> security_dashboard.md
          echo "| æŒ‡æ¨™ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è©³ç´° |" >> security_dashboard.md
          echo "|------|-----------|------|" >> security_dashboard.md
          echo "| è„…å¨ãƒ¬ãƒ™ãƒ« | ${{ needs.threat-intelligence.outputs.threat-level }} | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è„…å¨: ${{ needs.threat-intelligence.outputs.active-threats }}ä»¶ |" >> security_dashboard.md
          echo "| ç›£è¦–çŠ¶æ³ | ${{ needs.real-time-monitoring.result }} | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–å®Ÿè¡Œæ¸ˆã¿ |" >> security_dashboard.md
          echo "| ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ | ${{ needs.compliance-audit.result }} | ä¼æ¥­ãƒ¬ãƒ™ãƒ«ç›£æŸ»å®Ÿè¡Œæ¸ˆã¿ |" >> security_dashboard.md
          echo "" >> security_dashboard.md

      - name: ğŸ“‹ Integrate All Security Reports
        run: |
          echo "## ğŸ“‹ Detailed Security Reports" >> security_dashboard.md
          echo "" >> security_dashboard.md

          # å„ãƒ¬ãƒãƒ¼ãƒˆã‚’çµ±åˆ
          for report_dir in */; do
            if [ -d "$report_dir" ] && [ "$(ls -A $report_dir)" ]; then
              echo "### ğŸ“„ $(basename "$report_dir" | sed 's/-/ /g' | tr '[:lower:]' '[:upper:]')" >> security_dashboard.md
              echo "" >> security_dashboard.md

              for file in "$report_dir"/*.md; do
                if [ -f "$file" ]; then
                  cat "$file" >> security_dashboard.md
                  echo "" >> security_dashboard.md
                  echo "---" >> security_dashboard.md
                  echo "" >> security_dashboard.md
                fi
              done
            fi
          done

      - name: ğŸ¯ Generate Action Items
        run: |
          echo "## ğŸ¯ Priority Action Items" >> security_dashboard.md
          echo "" >> security_dashboard.md

          # è„…å¨ãƒ¬ãƒ™ãƒ«ã«åŸºã¥ãæ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
          if [ "${{ needs.threat-intelligence.outputs.threat-level }}" == "elevated" ]; then
            echo "### ğŸš¨ Immediate Actions Required" >> security_dashboard.md
            echo "" >> security_dashboard.md
            echo "1. **ç·Šæ€¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼**: 24æ™‚é–“ä»¥å†…" >> security_dashboard.md
            echo "2. **è„†å¼±æ€§ãƒ‘ãƒƒãƒé©ç”¨**: 48æ™‚é–“ä»¥å†…" >> security_dashboard.md
            echo "3. **ç›£è¦–é »åº¦ã®å¢—åŠ **: 6æ™‚é–“æ¯ â†’ 1æ™‚é–“æ¯" >> security_dashboard.md
          else
            echo "### âœ… Standard Monitoring Continues" >> security_dashboard.md
            echo "" >> security_dashboard.md
            echo "- å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™" >> security_dashboard.md
            echo "- æ¬¡å›ã®åŒ…æ‹¬çš„ãƒ¬ãƒ“ãƒ¥ãƒ¼äºˆå®š: æ¬¡å›ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œæ™‚" >> security_dashboard.md
          fi

          echo "" >> security_dashboard.md
          echo "---" >> security_dashboard.md
          echo "*ã“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ  (Issue #419) ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*" >> security_dashboard.md

      - name: Upload comprehensive dashboard
        uses: actions/upload-artifact@v4
        with:
          name: comprehensive-security-dashboard-${{ github.sha }}
          path: security_dashboard.md
          retention-days: 30

      - name: Notify security team
        if: needs.threat-intelligence.outputs.threat-level == 'elevated'
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');

            try {
              const dashboard = fs.readFileSync('security_dashboard.md', 'utf8');

              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `ğŸ“Š é«˜åº¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆ - ${new Date().toISOString().split('T')[0]}`,
                body: `## ğŸ” Advanced Security Monitoring Report\n\n${dashboard}\n\n**è‡ªå‹•ç”Ÿæˆæ™‚åˆ»**: ${new Date().toISOString()}`,
                labels: ['security', 'monitoring', 'report', 'automated'],
                assignees: ['kaenozu']
              });
            } catch (error) {
              console.error('ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆé€šçŸ¥ã‚¨ãƒ©ãƒ¼:', error);
            }
