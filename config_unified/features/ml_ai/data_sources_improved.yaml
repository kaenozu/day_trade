# 改善版データソース設定ファイル
# Issue #853対応：マルチソースデータプロバイダーの強化

data_sources:
  # Yahoo Finance設定（改善版）
  yahoo_finance:
    enabled: true
    priority: 1
    timeout: 30
    retry_count: 3
    rate_limit_per_minute: 60
    rate_limit_per_day: 1000
    quality_threshold: 80.0

    # API設定
    api_key: null
    base_url: null
    headers: {}

    # データ品質設定
    min_data_points: 5
    max_price_threshold: 1000000  # 100万円
    price_consistency_check: true

    # キャッシュ設定
    cache_enabled: true
    cache_ttl_seconds: 300  # 5分

    # Yahoo Finance固有設定
    symbol_variations:
      - "{symbol}.T"     # 東京証券取引所（優先）
      - "{symbol}.JP"    # 日本
      - "{symbol}"       # そのまま
      - "{symbol}.TO"    # 東京
      - "{symbol}.TYO"   # Tokyo

    # エラーハンドリング設定
    log_failed_variations: true
    detailed_error_logging: true

  # Stooq設定（改善版）
  stooq:
    enabled: true
    priority: 2
    timeout: 20
    retry_count: 2
    rate_limit_per_minute: 30
    rate_limit_per_day: 500
    quality_threshold: 70.0

    # API設定
    base_url: "https://stooq.com/q/d/l/"
    headers:
      User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"

    # データ品質設定
    min_data_points: 3
    max_price_threshold: 2000000  # より高い閾値
    price_consistency_check: true

    # キャッシュ設定
    cache_enabled: true
    cache_ttl_seconds: 600  # 10分

    # Stooq固有設定
    symbol_conversion:
      ".T": ".jp"
      ".JP": ".jp"
      default_suffix: ".jp"

  # Alpha Vantage設定（将来拡張用）
  alpha_vantage:
    enabled: false
    priority: 3
    timeout: 30
    retry_count: 3
    rate_limit_per_minute: 5
    rate_limit_per_day: 500
    quality_threshold: 85.0

    # API設定
    api_key: null  # 実際のAPIキーを設定
    base_url: "https://www.alphavantage.co/query"
    headers: {}

    # データ品質設定
    min_data_points: 10
    max_price_threshold: 5000000
    price_consistency_check: true

    # キャッシュ設定
    cache_enabled: true
    cache_ttl_seconds: 900  # 15分

  # Mock データプロバイダー（テスト用）
  mock:
    enabled: true
    priority: 99  # 最低優先度
    timeout: 1
    retry_count: 1
    rate_limit_per_minute: 1000
    rate_limit_per_day: 10000
    quality_threshold: 50.0

    # データ品質設定
    min_data_points: 1
    max_price_threshold: 10000000
    price_consistency_check: false

    # キャッシュ設定
    cache_enabled: false
    cache_ttl_seconds: 60

    # Mock固有設定
    random_seed: 42
    volatility: 0.02  # 2%
    base_price_range: [500, 5000]

# グローバル設定
global_settings:
  # フォールバック戦略
  fallback_strategy: "priority_order"  # priority_order, round_robin, fastest

  # 品質設定
  min_acceptable_quality: 50.0
  prefer_high_quality: true
  quality_weight: 0.7

  # パフォーマンス設定
  concurrent_requests: 3
  request_timeout: 60
  connection_pool_size: 10

  # キャッシュ設定
  default_cache_ttl: 300
  max_cache_size_mb: 100
  cache_cleanup_interval: 3600  # 1時間

  # ログ設定
  log_level: "INFO"
  log_fetch_statistics: true
  log_performance_metrics: true

  # エラーハンドリング
  max_consecutive_failures: 5
  failure_cooldown_seconds: 300
  auto_disable_failing_sources: true

# 市場別設定
market_specific:
  japanese_stocks:
    preferred_sources: ["yahoo_finance", "stooq"]
    symbol_patterns:
      - "^[0-9]{4}$"  # 4桁数字
      - "^[0-9]{4}\\.[A-Z]+$"  # 4桁数字.サフィックス

    quality_adjustments:
      yahoo_finance: 1.0
      stooq: 0.9

    cache_settings:
      trading_hours_ttl: 60    # 取引時間中は1分
      after_hours_ttl: 3600    # 取引時間外は1時間

  us_stocks:
    preferred_sources: ["yahoo_finance", "alpha_vantage"]
    symbol_patterns:
      - "^[A-Z]{1,5}$"  # 1-5文字のアルファベット

    quality_adjustments:
      yahoo_finance: 1.0
      alpha_vantage: 1.1

    cache_settings:
      trading_hours_ttl: 30
      after_hours_ttl: 1800

# 運用設定
operational:
  # 監視設定
  monitoring:
    enabled: true
    check_interval: 300  # 5分
    alert_thresholds:
      success_rate_low: 70.0
      response_time_high: 10.0
      quality_score_low: 60.0

  # 自動調整
  auto_adjustment:
    enabled: true
    adjust_priorities: true
    adjust_timeouts: true
    adjust_quality_thresholds: false

  # メンテナンス
  maintenance:
    cache_cleanup_hour: 2  # AM 2:00
    statistics_reset_day: "sunday"
    config_backup_enabled: true

  # アラート
  alerts:
    email_notifications: false
    webhook_url: null
    slack_webhook: null

# 開発・テスト設定
development:
  # テストモード
  test_mode: false
  mock_data_only: false
  simulate_failures: false

  # デバッグ
  debug_logging: false
  save_raw_responses: false
  performance_profiling: false

  # 制限緩和
  ignore_rate_limits: false
  bypass_quality_checks: false
  force_cache_refresh: false